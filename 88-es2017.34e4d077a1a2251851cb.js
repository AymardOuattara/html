(self.webpackChunkwil_admin_angular=self.webpackChunkwil_admin_angular||[]).push([[88],{2088:function(e,t,i){"use strict";i.r(t),i.d(t,{AccessManagementModule:function(){return oe}});var s=i(38583),o=i(3679),l=i(65461),a=i(977),n=i(66782),r=i(98542),d=i(24020),c=i(95987),p=i(99688);const u={},m={},h=[{template:"<p>Vous pouvez ajouter des departements \xe0 votre organisation.</p>"},{fieldGroup:[{fieldGroupClassName:"d-flex flex-wrap",fieldGroup:[{className:"flex-5 wl-hidden",key:"id",type:"input",templateOptions:{translate:!0,label:"ID",readonly:!0}},{className:"flex-5",key:"code",type:"input",templateOptions:{translate:!0,label:"Code",required:!0},expressionProperties:{"model.code":(e,t,i)=>{if(e.code)return e.code.toUpperCase().split(" ").join("_")}}},{className:"flex-5",key:"label",type:"input",templateOptions:{translate:!0,label:"Libelle",required:!0}},{className:"flex-5",key:"description",type:"input",templateOptions:{translate:!0,label:"Description"}},{className:"flex-1",key:"status",type:"checkbox",templateOptions:{translate:!0,label:"Est actif ?"},defaultValue:!0}]},{fieldGroupClassName:"action-bloc",fieldGroup:[{className:"flex-1",type:"button",templateOptions:{type:"submit",label:"Soumettre",translate:!0,loading:!1,disabled:!0,colorType:"primary",click:e=>{console.log("clik on submit"),e.templateOptions.loading=!0,e.form.statusChanges.subscribe(t=>{e.templateOptions.loading&&(e.templateOptions.loading=!1)})}},expressionProperties:{"templateOptions.disabled":(e,t,i)=>!i.form.valid}},{type:"button",templateOptions:{type:"reset",label:"R\xe9initialiser",bgColor:"#000",textColor:"#fff",click:e=>{e.options.resetModel(u)}}}]}]}];var f=i(42394),g=i(91841),b=i(37716),v=i(44212),S=i(18859),T=i(52121),O=i(68058),y=i(4768),x=i(28723);function k(e,t){if(1&e){const e=b.EpF();b.TgZ(0,"wl-form",7),b.NdJ("onSubmit",function(t){return b.CHM(e),b.oxw().save(t)})("onModelChange",function(t){return b.CHM(e),b.oxw().modelChange(t)}),b.qZA()}if(2&e){const e=b.oxw();b.Q6J("alert",e.alert)("model",e.form.model)("fields",e.form.fields)("options",e.form.options)}}const E=i(23815);let A=(()=>{class e extends p.K{constructor(e,t,i,s,o,l,a,n){super(e,t,i,s,o,l,a),this.logger=e,this.httpService=t,this.envService=i,this.messageService=s,this.authService=o,this.menuService=l,this.modal=a,this.changeDetectorRef=n,this.isEditMode=!1,this.isVisible=!1;const r=this.authService.hasPermissionAuthorizationV2(["USER_LIST.CREATE","USER_LIST.LOCK","USER_LIST.EDIT","USER_LIST.UNLOCK","USER_LIST.EXPORT","USER_LIST.DELETE","SHOW_DATA.ALL_ENTITY","SHOW_DATA.ROOT"]);this.hasPermissionToLock=r[1],this.hasPermissionToEdit=r[2],this.hasPermissionToUnlock=r[3],this.hasPermissionToExport=r[4],this.hasPermissionToDelete=r[5],this.hasPermissionToShowAllEntityData=r[6],this.hasPermissionToShowDataRoot=r[7],this.hasPermissionToCreate=r[0]}maFonction(){this.form.fields[0].template="<p>Veuillez remplir ce formulaire pour cr\xe9er une permission.</p>",this.isVisible=!0,this.isEditMode=!1}get modalTitle(){return this.isEditMode?"Mise \xe0 jour":"Ajouter"}ngAfterViewInit(){}ngOnInit(){this.form.model=Object.assign({},u),this.form.fields=h,this.form.options=m,this.globalFilterFields=["code","label"],this.columns=[{field:"code",header:"Code"},{field:"label",header:"Libelle"},{field:"description",header:"Description"},{field:"status",header:"STATUS",type:"status",falseText:"Non",trueText:"Oui"},{field:"created_at",header:"CREATED_AT",type:"date"}],this.user&&this.hasPermissionToEdit&&this.actions.push({type:"default",icon:"edit",shape:"circle",loading:!1,click:e=>{this.edit(e),this.logger.log(e),this.isEditMode=!0,this.isVisible=!0,this.form.fields[0].template="<p>Veuillez renseigner ce formulaire pour modifier les informations de la dite permission.</p>",setTimeout(()=>{this.alert=void 0,e.status=0!=e.status,this.form.model=Object.assign({},e),this.form.fields[0].fieldGroup[0].template=`<h5>Vous modifiez de l'utilisateur <i>${e.login}</i> </h5>`,this.form.fields[0].fieldGroup[1].fieldGroup[0].templateOptions.label="Enregistrer",this.changeDetectorRef.detectChanges()},1)}}),this.user&&this.hasPermissionToDelete&&this.actions.push({type:"default",icon:"warning",shape:"circle",popConfirm:!0,popTitle:"Etes-vous s\xfbre ?",cancelText:"Annuler",okText:"Oui",loading:!1,click:e=>{this.swingstatus(e)},cancel:e=>{}}),this.user&&this.hasPermissionToDelete&&this.actions.push({type:"default",icon:"delete",shape:"circle",popConfirm:!0,popTitle:"Etes-vous s\xfbre ?",cancelText:"Annuler",okText:"Oui",loading:!1,click:e=>{this.delete(e,"profiles")},cancel:e=>{}})}save(e){if(console.log(e),1==this.isEditMode){this.changeDetectorRef.detectChanges(),this.logger.log("event.model: ",e.model);let t=Object.assign(Object.assign({},e.model),{phone:e.model.prefix+" "+e.model.phone,session:this.user.session_id});this.logger.log("payload ",t);const i=t.id;t=E.omit(t,["id"]),t=Object.assign(Object.assign({},t),{updated_user:this.user.id}),this.putData(`${f.T5}/profiles/${i}`,t,e=>{e instanceof g.UA||(this.loadData(this.currentLoadEvent),this.isVisible=!1)})}else{let t=Object.assign(Object.assign({},e.model),{code:e.model.code,libelle:e.model.libelle,session:this.user.session_id});console.log(t),this.logger.log("payload ",t),t.id&&null!=t.id?(t=Object.assign(Object.assign({},t),{added_user:this.user.id}),this.postData(`${f.T5}/profiles`,t,e=>{e instanceof g.UA||this.loadData(this.currentLoadEvent)})):(console.log(t),t=E.omit(t,["id"]),t=Object.assign(Object.assign({},t),{added_user:this.user.id}),this.postData(`${f.T5}/profiles`,t,e=>{e instanceof g.UA||(this.loadData(this.currentLoadEvent),this.isVisible=!1)}))}}swingstatus(e){const t=e.id,i=e.status;if(1==i){let i=E.omit(e,["id"]);i={status:!1,updated_user:this.user.id},this.putData(`${f.T5}/profiles/${t}`,i,e=>{e instanceof g.UA||this.loadData(this.currentLoadEvent)})}if(0==i){let i=E.omit(e,["id"]);i={status:!0,updated_user:this.user.id},this.putData(`${f.T5}/profiles/${t}`,i,e=>{e instanceof g.UA||this.loadData(this.currentLoadEvent)})}}loadData(e){this.loading=!0,this.currentLoadEvent=e,this.getData(`${this.hasPermissionToShowAllEntityData?`${f.T5}/profiles/`:`${f.T5}/profiles/byEntity/${this.user.entity.id}`}?page=${e.first/e.rows+1}&per_page=${e.rows}${null!=e.globalFilter?`&search={"sKey":"all","sValue":"${e.globalFilter}"}`:""}${e.sortField&&null!=e.sortField?`&sort=[{"sortField":"${e.sortField}","sortOrder":"${1==e.sortOrder?"ASC":"DESC"}"}]`:'&sort=[{"sortField":"id","sortOrder":"DESC"}]'}`,e=>{if(!(e instanceof g.UA)){let t=e.body.rows;this.user&&!this.user.is_root&&(t=t.filter(e=>!e.is_root)),this.hasPermissionToShowDataRoot||(t=t.filter(e=>!e.profiles.map(e=>e.code).includes("PROF_ROOT"))),t=t.map(e=>Object.assign(Object.assign({},e),{trClass:e.status?"Actif":"Inactif"})),this.data=t,this.loading=!1,this.changeDetectorRef.detectChanges()}})}handleCancel(){this.isVisible=!1}}return e.\u0275fac=function(t){return new(t||e)(b.Y36(v.Kf),b.Y36(S.O),b.Y36(T.L),b.Y36(O.dD),b.Y36(y.e),b.Y36(x.h),b.Y36(r.Sf),b.Y36(b.sBO))},e.\u0275cmp=b.Xpm({type:e,selectors:[["profile"]],features:[b.qOj],decls:11,vars:18,consts:[["nzWidth","920px",3,"nzVisible","nzTitle","nzFooter","nzVisibleChange","nzOnCancel"],[3,"alert","model","fields","options","onSubmit","onModelChange",4,"nzModalContent"],[2,"width","100%","text-align","center"],[2,"border","3px dashed whitesmoke","padding","400px"],[2,"font-size","small"],[1,"button-19",2,"margin-left","20px",3,"click"],[3,"data","styleClass","showTools","columns","actions","lazy","caption","paginator","rows","totalRecords","loading","globalFilterFields","onLazyLoad"],[3,"alert","model","fields","options","onSubmit","onModelChange"]],template:function(e,t){1&e&&(b.TgZ(0,"nz-modal",0),b.NdJ("nzVisibleChange",function(e){return t.isVisible=e})("nzOnCancel",function(){return t.handleCancel()}),b.YNc(1,k,1,4,"wl-form",1),b.qZA(),b._UZ(2,"br"),b.TgZ(3,"table",2),b.TgZ(4,"tr",3),b.TgZ(5,"td"),b.TgZ(6,"h5",4),b._uU(7," Ajouter un profil \xe0 votre organisation en cliquant sur ce bouton "),b.TgZ(8,"button",5),b.NdJ("click",function(){return t.maFonction()}),b._uU(9,"Ajouter"),b.qZA(),b.qZA(),b.qZA(),b.qZA(),b.qZA(),b.TgZ(10,"wl-table",6),b.NdJ("onLazyLoad",function(e){return t.loadData(e)}),b.qZA()),2&e&&(b.Q6J("nzVisible",t.isVisible)("nzTitle",t.modalTitle)("nzFooter",null),b.xp6(10),b.Udp("margin-top","1rem"),b.Q6J("data",t.data)("styleClass","p-datatable-gridlines p-datatable-sm")("showTools",t.hasPermissionToExport)("columns",t.columns)("showTools",!0)("actions",t.actions)("lazy",!0)("caption","Departements")("paginator",!0)("rows",t.rows)("totalRecords",t.totalRecords)("loading",t.loading)("globalFilterFields",t.globalFilterFields))},directives:[r.du,r.Hf,a.a,l.U],styles:[".search-input .inline{display:inline-block;margin:0!important;padding:0!important}  .search-input .inline nz-input-group{border-radius:.2rem 0 0 .2rem!important}  .search-input .inline:last-child button{border-radius:0 0 10px 0}  .search-input .inline:last-child{position:relative;top:1.8rem;left:-1.5px;margin:0;padding:0}  .search-input .inline:last-child nz-input-group{border-radius:0 .2rem .2rem 0!important}  .button-19{background:#0d6d3a;border:1px solid #0d6d3a;border-radius:6px;box-shadow:1px 2px 4px rgba(0,0,0,.1);box-sizing:border-box;color:#fff;cursor:pointer;display:inline-block;font-family:nunito,roboto,proxima-nova,proxima nova,sans-serif;font-size:13px;font-weight:800;line-height:16px;min-height:40px;outline:0;padding:12px 14px;text-align:center;text-rendering:geometricprecision;text-transform:none;-moz-user-select:none;user-select:none;-webkit-user-select:none;touch-action:manipulation;vertical-align:middle}  .button-19:active,   .button-19:hover{background-color:transparent;background-color:initial;background-position:0 0;color:#0d6d3a}"],changeDetection:0}),e})();const _={},P={},C=[{template:"<p>Vous pouvez ajouter des departements \xe0 votre organisation.</p>"},{fieldGroup:[{fieldGroupClassName:"d-flex flex-wrap",fieldGroup:[{className:"flex-auto wl-hidden",key:"id",type:"input",templateOptions:{translate:!0,label:"ID",readonly:!0}},{className:"flex-5",key:"code",type:"input",templateOptions:{translate:!0,label:"Code",required:!0},expressionProperties:{"model.code":(e,t,i)=>{if(e.code)return e.code.toUpperCase().split(" ").join("_")}}},{className:"flex-5",key:"label",type:"input",templateOptions:{translate:!0,label:"Libelle",required:!0}},{className:"flex-auto",key:"description",type:"input",templateOptions:{translate:!0,label:"Description"}},{className:"flex-1",key:"status",type:"checkbox",templateOptions:{translate:!0,label:"Est actif ?"},defaultValue:!0}]},{fieldGroupClassName:"action-bloc",fieldGroup:[{className:"flex-1",type:"button",templateOptions:{type:"submit",label:"Soumettre",translate:!0,loading:!1,disabled:!0,colorType:"primary",click:e=>{console.log("clik on submit"),e.templateOptions.loading=!0,e.form.statusChanges.subscribe(t=>{e.templateOptions.loading&&(e.templateOptions.loading=!1)})}},expressionProperties:{"templateOptions.disabled":(e,t,i)=>!i.form.valid}},{type:"button",templateOptions:{type:"reset",label:"R\xe9initialiser",bgColor:"#000",textColor:"#fff",click:e=>{e.options.resetModel(_)}}}]}]}];var w=i(33013);function D(e,t){if(1&e){const e=b.EpF();b.TgZ(0,"wl-form",7),b.NdJ("onSubmit",function(t){return b.CHM(e),b.oxw().save(t)})("onModelChange",function(t){return b.CHM(e),b.oxw().modelChange(t)}),b.qZA()}if(2&e){const e=b.oxw();b.Q6J("alert",e.alert)("model",e.form.model)("fields",e.form.fields)("options",e.form.options)}}const L=i(23815);let z,R=(()=>{class e extends p.K{constructor(e,t,i,s,o,l,a,n){super(e,t,i,s,o,l,a),this.logger=e,this.httpService=t,this.envService=i,this.messageService=s,this.authService=o,this.menuService=l,this.modal=a,this.changeDetectorRef=n,this.isEditMode=!1,this.isVisible=!1;const r=this.authService.hasPermissionAuthorizationV2(["USER_LIST.CREATE","USER_LIST.LOCK","USER_LIST.EDIT","USER_LIST.UNLOCK","USER_LIST.EXPORT","USER_LIST.DELETE","SHOW_DATA.ALL_ENTITY","SHOW_DATA.ROOT"]);this.hasPermissionToLock=r[1],this.hasPermissionToEdit=r[2],this.hasPermissionToUnlock=r[3],this.hasPermissionToExport=r[4],this.hasPermissionToDelete=r[5],this.hasPermissionToShowAllEntityData=r[6],this.hasPermissionToShowDataRoot=r[7],this.hasPermissionToCreate=r[0]}maFonction(){this.form.fields[0].template="<p>Veuillez remplir ce formulaire pour cr\xe9er une permission.</p>",this.isVisible=!0,this.isEditMode=!1}get modalTitle(){return this.isEditMode?"Mise \xe0 jour":"Ajouter"}ngAfterViewInit(){}ngOnInit(){this.form.model=Object.assign({},_),this.form.fields=C,this.form.options=P,this.globalFilterFields=["code","libelle","status"],this.columns=[{field:"code",header:"Code"},{field:"label",header:"Libelle"},{field:"status",header:"STATUS",type:"status",falseText:"Inactif",trueText:"Actif"},{field:"created_at",header:"CREATED_AT",type:"date"}],this.user&&this.hasPermissionToEdit&&this.actions.push({type:"default",icon:"edit",shape:"circle",loading:!1,click:e=>{this.edit(e),this.logger.log(e),this.isEditMode=!0,this.isVisible=!0,this.form.fields[0].template="<p>Veuillez renseigner ce formulaire pour modifier les informations de la dite permission.</p>",setTimeout(()=>{this.alert=void 0,e.status=0!=e.status,this.form.model=Object.assign({},e),this.form.fields[0].fieldGroup[0].template=`<h5>Vous modifiez de l'utilisateur <i>${e.login}</i> </h5>`,this.form.fields[0].fieldGroup[1].fieldGroup[0].templateOptions.label="Enregistrer",this.changeDetectorRef.detectChanges()},1)}}),this.user&&this.hasPermissionToDelete&&this.actions.push({type:"default",icon:"warning",shape:"circle",popConfirm:!0,popTitle:"Etes-vous s\xfbre ?",cancelText:"Annuler",okText:"Oui",loading:!1,click:e=>{this.swingstatus(e)},cancel:e=>{}}),this.user&&this.hasPermissionToDelete&&this.actions.push({type:"default",icon:"delete",shape:"circle",popConfirm:!0,popTitle:"Etes-vous s\xfbre ?",cancelText:"Annuler",okText:"Oui",loading:!1,click:e=>{this.delete(e,"permissions")},cancel:e=>{}})}save(e){if(console.log(e),1==this.isEditMode){this.changeDetectorRef.detectChanges(),this.logger.log("event.model: ",e.model);let t=Object.assign(Object.assign({},e.model),{phone:e.model.prefix+" "+e.model.phone,session:this.user.session_id});this.logger.log("payload ",t);const i=t.id;t=L.omit(t,["id"]),t=Object.assign(Object.assign({},t),{updated_user:this.user.id}),this.putData(`${f.T5}/permissions/${i}`,t,e=>{e instanceof g.UA||(this.loadData(this.currentLoadEvent),this.isVisible=!1)})}else{let t=Object.assign(Object.assign({},e.model),{code:e.model.code,libelle:e.model.libelle,session:this.user.session_id});console.log(t),this.logger.log("payload ",t),t.id&&null!=t.id?(t=Object.assign(Object.assign({},t),{added_user:this.user.id}),this.postData(`${f.T5}/permissions`,t,e=>{e instanceof g.UA||this.loadData(this.currentLoadEvent)})):(console.log(t),t=L.omit(t,["id"]),t=Object.assign(Object.assign({},t),{added_user:this.user.id}),this.postData(`${f.T5}/permissions`,t,e=>{e instanceof g.UA||(this.loadData(this.currentLoadEvent),this.isVisible=!1)}))}}swingstatus(e){const t=e.id,i=e.status;if(1==i){let i=L.omit(e,["id"]);i={status:!1,updated_user:this.user.id},this.putData(`${f.T5}/permissions/${t}`,i,e=>{e instanceof g.UA||this.loadData(this.currentLoadEvent)})}if(0==i){let i=L.omit(e,["id"]);i={status:!0,updated_user:this.user.id},this.putData(`${f.T5}/permissions/${t}`,i,e=>{e instanceof g.UA||this.loadData(this.currentLoadEvent)})}}loadData(e){this.loading=!0,this.currentLoadEvent=e,this.getData(`${f.T5}/permissions/?page=${e.first/e.rows+1}&per_page=${e.rows}${null!=e.globalFilter?`&search={"sKey":"all","sValue":"${e.globalFilter}"}`:""}${e.sortField&&null!=e.sortField?`&sort=[{"sortField":"${e.sortField}","sortOrder":"${1==e.sortOrder?"ASC":"DESC"}"}]`:'&sort=[{"sortField":"id","sortOrder":"DESC"}]'}`,e=>{if(!(e instanceof g.UA)){let t=e.body.rows;this.user&&!this.user.is_root&&(t=t.filter(e=>!e.is_root)),this.hasPermissionToShowDataRoot||(t=t.filter(e=>!e.profiles.map(e=>e.code).includes("PROF_ROOT"))),t=t.map(e=>Object.assign(Object.assign({},e),{trClass:e.status?"Actif":"Inactif"})),this.data=t,this.loading=!1,this.changeDetectorRef.detectChanges()}})}handleCancel(){this.isVisible=!1}}return e.\u0275fac=function(t){return new(t||e)(b.Y36(v.Kf),b.Y36(S.O),b.Y36(T.L),b.Y36(O.dD),b.Y36(y.e),b.Y36(x.h),b.Y36(r.Sf),b.Y36(b.sBO))},e.\u0275cmp=b.Xpm({type:e,selectors:[["permission"]],features:[b._Bn([w.ez]),b.qOj],decls:11,vars:18,consts:[["nzWidth","920px",3,"nzVisible","nzTitle","nzFooter","nzVisibleChange","nzOnCancel"],[3,"alert","model","fields","options","onSubmit","onModelChange",4,"nzModalContent"],[2,"width","100%","text-align","center"],[2,"border","3px dashed whitesmoke","padding","400px"],[2,"font-size","small"],[1,"button-19",2,"margin-left","20px",3,"click"],[3,"data","styleClass","showTools","columns","actions","lazy","caption","paginator","rows","totalRecords","loading","globalFilterFields","onLazyLoad"],[3,"alert","model","fields","options","onSubmit","onModelChange"]],template:function(e,t){1&e&&(b.TgZ(0,"nz-modal",0),b.NdJ("nzVisibleChange",function(e){return t.isVisible=e})("nzOnCancel",function(){return t.handleCancel()}),b.YNc(1,D,1,4,"wl-form",1),b.qZA(),b._UZ(2,"br"),b.TgZ(3,"table",2),b.TgZ(4,"tr",3),b.TgZ(5,"td"),b.TgZ(6,"h5",4),b._uU(7," Ajouter une permission \xe0 votre organisation en cliquant sur ce bouton "),b.TgZ(8,"button",5),b.NdJ("click",function(){return t.maFonction()}),b._uU(9,"Ajouter"),b.qZA(),b.qZA(),b.qZA(),b.qZA(),b.qZA(),b.TgZ(10,"wl-table",6),b.NdJ("onLazyLoad",function(e){return t.loadData(e)}),b.qZA()),2&e&&(b.Q6J("nzVisible",t.isVisible)("nzTitle",t.modalTitle)("nzFooter",null),b.xp6(10),b.Udp("margin-top","1rem"),b.Q6J("data",t.data)("styleClass","p-datatable-gridlines p-datatable-sm")("showTools",t.hasPermissionToExport)("columns",t.columns)("showTools",!0)("actions",t.actions)("lazy",!0)("caption","Departements")("paginator",!0)("rows",t.rows)("totalRecords",t.totalRecords)("loading",t.loading)("globalFilterFields",t.globalFilterFields))},directives:[r.du,r.Hf,a.a,l.U],styles:[".search-input .inline{display:inline-block;margin:0!important;padding:0!important}  .search-input .inline nz-input-group{border-radius:.2rem 0 0 .2rem!important}  .search-input .inline:last-child button{border-radius:0 0 10px 0}  .search-input .inline:last-child{position:relative;top:1.8rem;left:-1.5px;margin:0;padding:0}  .search-input .inline:last-child nz-input-group{border-radius:0 .2rem .2rem 0!important}  .button-19{background:#0d6d3a;border:1px solid #0d6d3a;border-radius:6px;box-shadow:1px 2px 4px rgba(0,0,0,.1);box-sizing:border-box;color:#fff;cursor:pointer;display:inline-block;font-family:nunito,roboto,proxima-nova,proxima nova,sans-serif;font-size:13px;font-weight:800;line-height:16px;min-height:40px;outline:0;padding:12px 14px;text-align:center;text-rendering:geometricprecision;text-transform:none;-moz-user-select:none;user-select:none;-webkit-user-select:none;touch-action:manipulation;vertical-align:middle}  .button-19:active,   .button-19:hover{background-color:transparent;background-color:initial;background-position:0 0;color:#0d6d3a}"],changeDetection:0}),e})();const F={},V={formState:{menuPermSelected:[],menusSelected:[],showCreateText:!0}},N=[{fieldGroup:[{hide:!1,template:"<p>Vous pouvez attribuer des menus \xe0 un profil en suivant les \xe9tapes du formulaire.</p>",expressionProperties:{hide:(e,t,i)=>!V.formState.showCreateText}},{hide:!0,template:`Vous n'avez pas de profil rattach\xe9 \xe0 votre entit\xe9. Veuillez cliquer sur le lien suivant pour <a href='${f.b$}/private/administration/profile'>cr\xe9er un profil</a>`,expressionProperties:{hide:(e,t,i)=>V.formState.showCreateText}}]},{type:"stepper",templateOptions:{strictStepper:!0,nextText:"Suivant",previousText:"Pr\xe9c\xe9dent",doneText:"Soummettre",doneFn:e=>{e.model.action="SAVE",e.parent.templateOptions.doneLoading=!0,e.form.statusChanges.subscribe(t=>{e.parent.templateOptions.doneLoading&&(e.parent.templateOptions.doneLoading=!1)})}},fieldGroup:[{templateOptions:{label:"Select menu"},fieldGroupClassName:"d-flex flex-wrap",fieldGroup:[{className:"flex-5",key:"profile_id",type:"tree",templateOptions:{required:!0,translate:!0,multiple:!1,showExpand:!1,checkable:!1,label:"FORM_LABEL.PROFILE",options:[],dividerText:"Select_menus_to_add",divider:"right",onSelect:(e,t)=>{console.log("profil ==>",t);const i=t.node.origin;if(i.selected){const t=i.menus,s=t.map(e=>e.id),o=e.parent.fieldGroup[1].templateOptions.options;V.formState.menusSelected=[...s],e.parent.fieldGroup[1].templateOptions.checkedKeys=V.formState.menusSelected;const l=f._.flatMapDepth(o,function e(t){var i;return(null===(i=t.children)||void 0===i?void 0:i.length)?f._.flatMapDepth(t.children,e):t}).concat(o);e.parent.fieldGroup[1].templateOptions.checkAll=l.every(e=>s.includes(e.key)),e.form.markAllAsTouched(),V.formState.menuPermSelected=[...t.map(e=>{var t,i;return{value:null===(i=null===(t=e.ProfileMenu)||void 0===t?void 0:t.permission)||void 0===i?void 0:i.split(","),key:e.id}})],e.formControl.setValue(i),e.form.get("selected_menu").setValue(t.map(e=>Object.assign(Object.assign({},e),{title:e.label,key:e.id,isLeaf:!0})))}else V.formState.menuPermSelected=[],V.formState.menusSelected=[],e.parent.fieldGroup[1].templateOptions.checkedKeys=[],e.parent.fieldGroup[1].templateOptions.checkAll=!1,e.formControl.setValue(null),e.form.get("selected_menu").setValue([])}}},{className:"flex-5",key:"menu_id",type:"tree",templateOptions:{checkable:!0,multiple:!0,translate:!0,label:"FORM_LABEL.MENU",options:[],onCheckAll:(e,t,i)=>{setTimeout(()=>{console.log(i,t)},1e3);const s=t;function o(t){var s;if(i){const e=null===(s=t.permission)||void 0===s?void 0:s.map(e=>e.value);V.formState.menuPermSelected=M(V.formState.menuPermSelected,t.key,e)}else V.formState.menuPermSelected=V.formState.menuPermSelected.filter(e=>e.key!=t.key);t.children&&t.children.forEach(e=>{o(e)}),V.formState.menuPermSelected=f._.uniq(V.formState.menuPermSelected),V.formState.menusSelected=f._.uniq(V.formState.menuPermSelected.map(e=>e.key)),e.form.get("menuPermSelected").setValue(V.formState.menuPermSelected)}s.forEach(e=>{o(e.origin)}),e.form.get("selected_menu").setValue(s.map(e=>e.origin))},onCheck:(e,t)=>{var i;const s=t.node.origin,o=null===(i=t.node.parentNode)||void 0===i?void 0:i.origin,l=t.nodes.map(e=>e.origin);e.form.get("selected_menu").setValue(l),function t(i,s){var o;if(V.formState.menuPermSelected.find(e=>e.key==i.key))V.formState.menuPermSelected=V.formState.menuPermSelected.filter(e=>e.key!=i.key),s&&(V.formState.menuPermSelected=V.formState.menuPermSelected.filter(e=>e.key!=s.key));else{const e=null===(o=i.permission)||void 0===o?void 0:o.map(e=>e.value);V.formState.menuPermSelected=M(V.formState.menuPermSelected,i.key,e)}i.children&&i.children.forEach(e=>{t(e)}),V.formState.menuPermSelected=f._.uniq(V.formState.menuPermSelected),V.formState.menusSelected=f._.uniq(V.formState.menuPermSelected.map(e=>e.key)),e.form.get("menuPermSelected").setValue(V.formState.menuPermSelected)}(s,o)}},hooks:{onInit:e=>{e.templateOptions.checkedKeys=V.formState.menusSelected}},expressionProperties:{}}]},{templateOptions:{label:"Acces to the menu"},fieldGroup:[{fieldGroupClassName:"d-flex flex-wrap",fieldGroup:[{className:"flex-6",key:"selected_menu",type:"tree",templateOptions:{options:[],translate:!0,checkable:!1,label:"FORM_LABEL.SELECT_MENU",divider:"right",dividerText:"select_perm_to_add",onSelect:(e,t)=>{var i,s,o;z=null===(i=null==t?void 0:t.node)||void 0===i?void 0:i.origin,console.log(z);const l=(null===(s=V.formState.menuPermSelected.find(e=>e.key==z.key))||void 0===s?void 0:s.value)||[];let a=Array.isArray(null==z?void 0:z.permission)?z.permission:(null===(o=null==z?void 0:z.permission)||void 0===o?void 0:o.split(","))||[];a=null==a?void 0:a.map(e=>({key:e.value||e,title:e.label||e,isLeaf:!0})),e.form.markAllAsTouched(),e.parent.fieldGroup[1].templateOptions.checkedKeys=l,e.form.get("access").setValue(a)}},hooks:{onInit:e=>{let t=e.formControl.value;console.log("node ==>",t),e.templateOptions.options=t,e.form.get("profile_id").value.menus.forEach(e=>{if(j(t,e.id)){const t=e.ProfileMenu.permission.split(",")||[];V.formState.menuPermSelected=M(V.formState.menuPermSelected,e.id,t)}}),e.form.get("menuPermSelected").setValue(V.formState.menuPermSelected),console.log(V.formState.menuPermSelected)}}},{className:"flex-4",key:"access",type:"tree",templateOptions:{options:[],translate:!0,label:"FORM_LABEL.MENU_PERMISSIONS",onCheckAll:(e,t)=>{console.log(e,t);let i=e.templateOptions.checkedKeys;console.log(i),V.formState.menuPermSelected=M(V.formState.menuPermSelected,z.key,i),e.form.get("menuPermSelected").setValue(V.formState.menuPermSelected),console.log("menuPermSelected: ",V.formState.menuPermSelected)},onCheck:(e,t)=>{console.log(e,t),V.formState.menuPermSelected=M(V.formState.menuPermSelected,z.key,t.keys),e.form.get("menuPermSelected").setValue(V.formState.menuPermSelected),console.log("menuPermSelected: ",V.formState.menuPermSelected)}},hooks:{onInit:e=>{}}},{key:"menuPermSelected",type:"tree",templateOptions:{options:[],hidden:!0,required:!0}}]}]}]}];function M(e,t,i){if(null!=e){let s=j(e,t);s?(e=e.filter(e=>e.key!=t),s.value=i,e.push(s)):e.push({key:t,value:i})}else e.push({key:t,value:i});return e}function j(e,t){let i;for(let s of e){if(s.key==t){i=s;break}if(s.children&&null!=s.children&&(i=j(s.children,t),i))break}return i}let U=(()=>{class e extends p.K{constructor(e,t,i,s,o,l){super(e,t,i,s,o,l),this.logger=e,this.httpService=t,this.envService=i,this.messageService=s,this.authService=o,this.menuService=l;const a=this.authService.hasPermissionAuthorizationV2(["SHOW_DATA.ALL_ENTITY","SHOW_DATA.ROOT"]);this.hasPermissionToShowAllEntityData=a[0],this.hasPermissionToShowDataRoot=a[1]}ngOnInit(){this.form.fields=N,this.form.model=F,this.form.options=V,this.loadAllProfil(),this.loadAllmenu(),this.form.options.formState.menuPermSelected=[],this.form.fields[1].fieldGroup[0].fieldGroup[0].templateOptions.selectedKeys=[],this.form.fields[1].fieldGroup[0].fieldGroup[1].templateOptions.checkedKeys=[],this.form.fields[1].fieldGroup[0].fieldGroup[1].templateOptions.checkAll=!1}save(e){var t,i,s,o;this.logger.log("model: ",e.model);const l=(null===(t=e.model.menuPermSelected)||void 0===t?void 0:t.length)?null===(i=e.model.menuPermSelected)||void 0===i?void 0:i.map(t=>{var i,s,o;return{profile_id:null===(i=e.model.profile_id)||void 0===i?void 0:i.key,menu_id:t.key,permission:(null===(s=t.value)||void 0===s?void 0:s.join(","))||"foo",added_user:null===(o=this.user)||void 0===o?void 0:o.id,status:e.model.status}}):[{profile_id:null===(s=e.model.profile_id)||void 0===s?void 0:s.key,menu_id:void 0,permission:null,added_user:null===(o=this.user)||void 0===o?void 0:o.id,status:e.model.status}];this.logger.log("payload =>",l),"SAVE"==e.model.action&&this.httpService.postData(`${f.T5}/profile-menus`,l).subscribe(e=>{this.form.model={},this.form.options.resetModel(),this.setMessage("success","Enregistrement effectu\xe9 avec succ\xe8s !"),this.form.fields=this.mapFields(N,"submit","templateOptions.disabled",!0),this.form.options.formState.menuPermSelected=[],this.form.fields[1].fieldGroup[0].fieldGroup[0].templateOptions.selectedKeys=[],this.form.fields[1].fieldGroup[0].fieldGroup[1].templateOptions.checkedKeys=[],this.form.fields[1].fieldGroup[0].fieldGroup[1].templateOptions.checkAll=!1,this.loadAllProfil(),this.loadAllmenu()},e=>{this.logger.log("postData error ===> ",e),this.setBackendError(e.error);let t="";e.error.errors&&e.error.errors.forEach(e=>{t+=e.msg+" "+e.param+"\n"}),this.form.options.resetModel(),this.alert={type:"error",message:e.error.message,description:t}},()=>{})}loadAllProfil(){this.httpService.getData(this.hasPermissionToShowAllEntityData?`${f.T5}/profile-menus/deep`:`${f.T5}/profile-menus/byEntity/deep/${this.user.entity.id}`).toPromise().then(e=>{console.log(e);let t=e.body.rows;this.hasPermissionToShowDataRoot||(t=t.filter(e=>"PROF_ROOT"!=e.code)),t=t.map(e=>({key:e.id,title:e.label,label:e.label,menus:e.menus})),this.form.fields=this.mapFields(N,"profile_id","templateOptions.options",t),this.form.fields[1].fieldGroup[0].fieldGroup[0].templateOptions.options=t,0==t.length&&(this.form.options.formState.showCreateText=!1)}).catch(e=>{this.logger.error(e)})}loadAllmenu(){console.log("load menus"),this.user&&!this.user.is_root?(this.isSpinning=!1,console.log("menus user => ",this.user.menus),this.form.fields=this.mapFields(N,"menu_id","templateOptions.options",$(this.user.menus))):this.httpService.getData(`${f.T5}/menus/deep`).toPromise().then(e=>{let t=e.body.rows;t=$(t),this.logger.log("menus load => ",t),this.isSpinning=!1,this.form.fields=this.mapFields(N,"menu_id","templateOptions.options",t)}).catch(e=>{this.logger.error(e)})}}return e.\u0275fac=function(t){return new(t||e)(b.Y36(v.Kf),b.Y36(S.O),b.Y36(T.L),b.Y36(O.dD),b.Y36(y.e),b.Y36(x.h))},e.\u0275cmp=b.Xpm({type:e,selectors:[["profil-menu"]],features:[b.qOj],decls:2,vars:5,consts:[["nzTip","Chargement...",3,"nzSpinning"],[3,"alert","model","fields","options","onSubmit","onModelChange"]],template:function(e,t){1&e&&(b.TgZ(0,"nz-spin",0),b.TgZ(1,"wl-form",1),b.NdJ("onSubmit",function(e){return t.save(e)})("onModelChange",function(e){return t.modelChange(e)}),b.qZA(),b.qZA()),2&e&&(b.Q6J("nzSpinning",t.isSpinning),b.xp6(1),b.Q6J("alert",t.alert)("model",t.form.model)("fields",t.form.fields)("options",t.form.options))},directives:[n.W,l.U],styles:["[_nghost-%COMP%]{background:#fff;padding:10px!important;display:block}  .p-divider .p-divider-content{background-color:#f0f2f5}"]}),e})();function $(e,t){return e.map(e=>{var i,s;return{key:e.id,title:e[t]||e.label,label:e[t]||e.label,isLeaf:!(null===(i=e.sub)||void 0===i?void 0:i.length),children:$(e.sub,t),permission:null===(s=e.permission)||void 0===s?void 0:s.split(",").map(e=>({label:f._.capitalize(e),value:e}))}})}const G={},I={},Z=[{template:"<p>Vous pouvez ajouter des permissions \xe0 un profil en selectionnant les permissions que vous voulez lui attribuer.</p>"},{fieldGroupClassName:"d-flex flex-wrap flex-start",fieldGroup:[{className:"flex-5",key:"profile_id",type:"select",templateOptions:{required:!0,translate:!0,label:"Profil",options:[],valueProp:"id",labelProp:"label",onModelChange:(e,t)=>{const i=e.templateOptions.options.find(e=>e.id==t);if(i){let t=e.parent.fieldGroup[1].templateOptions.options;t=null==t?void 0:t.map(e=>{var t;return(null===(t=i.permissions)||void 0===t?void 0:t.map(e=>e.id).includes(e.id))?Object.assign(Object.assign({},e),{direction:"right"}):Object.assign(Object.assign({},e),{direction:"left"})}),e.parent.fieldGroup[1].templateOptions.options=t,e.form.get("permission_id").setValue(i.permissions)}}}},{className:"flex-10",key:"permission_id",type:"transfert",templateOptions:{translate:!0,required:!0,right:"Attribuer",left:"Retirer",showCode:!0,label:"Description",change:(e,t)=>{const i=e.templateOptions.options.filter(e=>"right"==e.direction);e.formControl.setValue(i)}}},{className:"flex-1",key:"status",type:"checkbox",templateOptions:{translate:!0,label:"Est actif ?"},defaultValue:!0}]},{fieldGroupClassName:"action-bloc",fieldGroup:[{className:"flex-1",type:"button",templateOptions:{type:"submit",label:"Soumettre",translate:!0,loading:!1,disabled:!0,colorType:"primary",click:e=>{e.templateOptions.loading=!0,e.form.statusChanges.subscribe(t=>{e.templateOptions.loading&&(e.templateOptions.loading=!1)})}},expressionProperties:{"templateOptions.disabled":(e,t,i)=>!i.form.valid}},{type:"button",templateOptions:{type:"reset",label:"R\xe9initialiser",bgColor:"#000",textColor:"#fff",click:e=>{e.options.resetModel(G)}}}]}];let q=(()=>{class e extends p.K{constructor(e,t,i,s,o,l,a){super(e,t,i,s,o,l),this.logger=e,this.httpService=t,this.envService=i,this.messageService=s,this.authService=o,this.menuService=l,this.cdRef=a;const n=this.authService.hasPermissionAuthorizationV2(["SHOW_DATA.ALL_ENTITY","SHOW_DATA.ROOT"]);this.hasPermissionToShowAllEntityData=n[0],this.hasPermissionToShowDataRoot=n[1]}ngOnInit(){this.form.model=G,this.form.fields=Z,this.form.options=I,this.loadAllProfilPermission(),this.loadAllPermission()}save(e){var t,i;this.logger.log("model: ",e.model);const s=(null===(t=e.model.permission_id)||void 0===t?void 0:t.length)?null===(i=e.model.permission_id)||void 0===i?void 0:i.map(t=>({profile_id:e.model.profile_id,permission_id:t.id,status:e.model.status,added_user:this.user.id})):[{profile_id:e.model.profile_id,permission_id:null,status:e.model.status,session:this.user.session_id,added_user:this.user.id}];this.logger.log("save user-profil ==> ",s),this.httpService.postData(`${f.T5}/profile-permissions`,s).subscribe(e=>{this.logger.log("postData response ===> ",e),this.setMessage("success","Enregistrement effectu\xe9 avec succ\xe8s !"),setTimeout(()=>{this.form.options.resetModel(),this.loadAllProfilPermission(),this.loadAllPermission()},1e3)},e=>{this.logger.log("postData error ===> ",e),this.setBackendError(e.error);let t="";e.error.errors&&e.error.errors.forEach(e=>{t+=e.msg+" "+e.param+"\n"}),this.alert={type:"error",message:e.error.message,description:t}},()=>{})}loadAllPermission(){this.httpService.getData(`${f.T5}/permissions`).toPromise().then(e=>{let t=e.body.rows;t=t.map(e=>Object.assign(Object.assign({},e),{title:e[void 0]||e.code,direction:"left"})),this.form.fields=this.mapFields(this.form.fields,"permission_id","templateOptions.options",t)}).catch(e=>{this.logger.error(e)})}loadAllProfilPermission(){this.httpService.getData(this.hasPermissionToShowAllEntityData?`${f.T5}/profile-permissions/deep`:`${f.T5}/profile-permissions/byEntity/deep/${this.user.entity.id}`).toPromise().then(e=>{this.isSpinning=!1;let t=e.body.rows;this.hasPermissionToShowDataRoot||(t=t.filter(e=>"PROF_ROOT"!=e.code)),this.form.fields=this.mapFields(this.form.fields,"profile_id","templateOptions.options",e.body.rows)}).catch(e=>{this.logger.error(e)})}}return e.\u0275fac=function(t){return new(t||e)(b.Y36(v.Kf),b.Y36(S.O),b.Y36(T.L),b.Y36(O.dD),b.Y36(y.e),b.Y36(x.h),b.Y36(b.sBO))},e.\u0275cmp=b.Xpm({type:e,selectors:[["profil-permission"]],features:[b.qOj],decls:2,vars:5,consts:[["nzTip","Chargement...",3,"nzSpinning"],[3,"alert","model","fields","options","onSubmit","onModelChange"]],template:function(e,t){1&e&&(b.TgZ(0,"nz-spin",0),b.TgZ(1,"wl-form",1),b.NdJ("onSubmit",function(e){return t.save(e)})("onModelChange",function(e){return t.modelChange(e)}),b.qZA(),b.qZA()),2&e&&(b.Q6J("nzSpinning",t.isSpinning),b.xp6(1),b.Q6J("alert",t.alert)("model",t.form.model)("fields",t.form.fields)("options",t.form.options))},directives:[n.W,l.U],styles:["[_nghost-%COMP%]{background:#fff;padding:10px!important;display:block}"]}),e})();const Y={},K={},J=[{template:"<p>Vous pouvez ajouter des menus \xe0 votre progiciel.</p>"},{fieldGroup:[{fieldGroupClassName:"d-flex flex-wrap",fieldGroup:[{className:"flex-5  wl-hidden",key:"id",type:"input",templateOptions:{translate:!0,label:"ID",readonly:!0}},{className:"flex-5",key:"code",type:"input",templateOptions:{translate:!0,label:"Code"},expressionProperties:{"model.code":(e,t,i)=>{if(e.code)return e.code.toUpperCase().split(" ").join("_")}}},{className:"flex-5",key:"label",type:"input",templateOptions:{translate:!0,label:"Libelle",required:!0}},{className:"flex-7",key:"description",type:"input",templateOptions:{translate:!0,label:"Description"}},{className:"flex-3",key:"parent_code",type:"select",templateOptions:{translate:!0,label:"Menu parent",options:[],showSearch:!0,allowClear:!0,valueProp:"code",labelProp:"label",onModelChange:e=>{var t;let i=(null===(t=e.templateOptions.options.filter(t=>t.code==e.formControl.value)[0])||void 0===t?void 0:t.routing)||"";e.form.get("namespace").setValue(i)}}},{className:"flex-3",key:"namespace",type:"input",templateOptions:{translate:!0,required:!0,label:"Namespace",readonly:!1,change:e=>{if(!e.model.parent_code){const t=e.formControl.value;e.form.get("routing").setValue(t)}}},expressionProperties:{"templateOptions.readonly":"model.parent_code"}},{className:"flex-4",key:"routing",type:"input",templateOptions:{translate:!0,label:"Path"},expressionProperties:{"templateOptions.addOnBefore":(e,t,i)=>{if(e.parent_code)return i.form.get("namespace").value},"templateOptions.readonly":"!model.parent_code && model.namespace"}},{className:"flex-2",key:"icon",type:"select",templateOptions:{translate:!0,showSearch:!0,allowClear:!0,label:"Icone",withIcon:!0,options:[{label:"user",value:"user",icon:"user"},{label:"mail",value:"mail",icon:"mail"},{label:"setting",value:"setting",icon:"setting"},{label:"code",value:"code",icon:"code"},{label:"control",value:"control",icon:"control"},{label:"container",value:"container",icon:"container"},{label:"database",value:"database",icon:"database"},{label:"dashboard",value:"dashboard",icon:"dashboard"},{label:"bank",value:"bank",icon:"bank"},{label:"line",value:"line",icon:"line"},{label:"step-backward",value:"step-backward",icon:"step-backward"},{label:"step-forward",value:"step-forward",icon:"step-forward"},{label:"fast-backward",value:"fast-backward",icon:"fast-backward"},{label:"fast-forward",value:"fast-forward",icon:"fast-forward"},{label:"shop",value:"shop",icon:"shop"},{label:"menu",value:"menu",icon:"menu"},{label:"calendar",value:"calendar",icon:"calendar"},{label:"file-text",value:"file-text",icon:"file-text"},{label:"apartment",value:"apartment",icon:"apartment"},{label:"team",value:"team",icon:"team"},{label:"tool",value:"tool",icon:"tool"},{label:"appstore",value:"appstore",icon:"appstore"},{label:"star",value:"star",icon:"star"},{label:"key",value:"key",icon:"key"},{label:"form",value:"form",icon:"form"},{label:"pie-chart",value:"pie-chart",icon:"pie-chart"},{label:"area-chart",value:"area-chart",icon:"area-chart"},{label:"stock",value:"stock",icon:"stock"},{label:"rise",value:"rise",icon:"rise"},{label:"fall",value:"fall",icon:"fall"},{label:"api",value:"api",icon:"api"},{label:"disconnect",value:"disconnect",icon:"disconnect"},{label:"desktop",value:"desktop",icon:"desktop"},{label:"contacts",value:"contacts",icon:"contacts"},{label:"comment",value:"comment",icon:"comment"},{label:"credit-card",value:"credit-card",icon:"credit-card"},{label:"audit",value:"audit",icon:"audit"}]},defaultValue:"line"},{className:"flex-10",key:"permission",type:"select",templateOptions:{translate:!0,required:!0,mode:"tags",label:"Actions possible",icon:"pi pi-shield",options:[{label:"CREATE",value:"CREATE"},{label:"EDIT",value:"EDIT"},{label:"DELETE",value:"DELETE"},{label:"EXPORT",value:"EXPORT"},{label:"CONSULT",value:"CONSULT"}],placeholder:"Saisie les actions possible pour ce menu"},defaultValue:[{label:"CREATE",value:"CREATE"},{label:"EDIT",value:"EDIT"},{label:"DELETE",value:"DELETE"},{label:"EXPORT",value:"EXPORT"},{label:"CONSULT",value:"CONSULT"}].map(e=>e.value)},{className:"flex-1",key:"order",type:"input",templateOptions:{required:!0,type:"number",translate:!0,label:"Ordre"},defaultValue:!0},{className:"flex-2",key:"status",type:"checkbox",templateOptions:{translate:!0,label:"Est actif ?"},defaultValue:!0},{className:"flex-2",key:"is_module",type:"checkbox",templateOptions:{translate:!0,label:"Est module ?"},defaultValue:!1},{className:"flex-2",key:"is_group_title",type:"checkbox",templateOptions:{translate:!0,label:"Est titre de groupe?"},defaultValue:!1,hideExpression:"model.is_module",expressionProperties:{}},{className:"flex-2",key:"is_load_menu",type:"checkbox",templateOptions:{translate:!0,label:"Charge menu ?"},hideExpression:"!model.is_module",expressionProperties:{"templateOptions.required":"model.is_module"}}]},{fieldGroupClassName:"action-bloc",fieldGroup:[{key:"submit",className:"flex-1",type:"button",templateOptions:{type:"submit",label:"Soumettre",translate:!0,loading:!1,disabled:!0,colorType:"primary",click:e=>{console.log("clik on submit"),e.templateOptions.loading=!0,e.form.statusChanges.subscribe(t=>{e.templateOptions.loading&&(e.templateOptions.loading=!1)})}},expressionProperties:{"templateOptions.disabled":(e,t,i)=>!i.form.valid}},{type:"button",templateOptions:{type:"reset",label:"R\xe9initialiser",bgColor:"#000",textColor:"#fff",click:e=>{e.options.resetModel(Y)}}}]}]}];function H(e,t){if(1&e){const e=b.EpF();b.TgZ(0,"wl-form",7),b.NdJ("onSubmit",function(t){return b.CHM(e),b.oxw().save(t)})("onModelChange",function(t){return b.CHM(e),b.oxw().modelChange(t)}),b.qZA()}if(2&e){const e=b.oxw();b.Q6J("alert",e.alert)("model",e.form.model)("fields",e.form.fields)("options",e.form.options)}}let B=(()=>{class e extends p.K{constructor(e,t,i,s,o,l,a,n){super(e,t,i,s,o,l,a),this.logger=e,this.httpService=t,this.envService=i,this.messageService=s,this.authService=o,this.menuService=l,this.modal=a,this.changeDetectorRef=n,this.isEditMode=!1,this.isVisible=!1;const r=this.authService.hasPermissionAuthorizationV2(["USER_LIST.CREATE","USER_LIST.LOCK","USER_LIST.EDIT","USER_LIST.UNLOCK","USER_LIST.EXPORT","USER_LIST.DELETE","SHOW_DATA.ALL_ENTITY","SHOW_DATA.ROOT"]);this.hasPermissionToLock=r[1],this.hasPermissionToEdit=r[2],this.hasPermissionToUnlock=r[3],this.hasPermissionToExport=r[4],this.hasPermissionToDelete=r[5],this.hasPermissionToShowAllEntityData=r[6],this.hasPermissionToShowDataRoot=r[7],this.hasPermissionToCreate=r[0]}maFonction(){this.form.fields[0].template="<p>Veuillez remplir ce formulaire pour cr\xe9er un menu.</p>",this.isVisible=!0,this.isEditMode=!1,this.form.model=Object.assign({},Y)}get modalTitle(){return this.isEditMode?"Mise \xe0 jour":"Ajouter"}ngAfterViewInit(){}ngOnInit(){this.form.model=Object.assign({},Y),this.form.fields=J,this.form.options=K,this.loadAllmenu(),this.globalFilterFields=["code","label"],this.columns=[{field:"code",header:"Code"},{field:"label",header:"Libelle"},{field:"description",header:"Description"},{field:"status",header:"STATUS",type:"status",falseText:"Non",trueText:"Oui"},{field:"created_at",header:"CREATED_AT",type:"date"}],this.user&&this.hasPermissionToEdit&&this.actions.push({type:"default",icon:"edit",shape:"circle",loading:!1,click:e=>{this.edit(e),this.logger.log(e),this.isEditMode=!0,this.isVisible=!0,console.log(e),this.form.fields[0].template="<p>Veuillez renseigner ce formulaire pour modifier les informations dudit menu.</p>",setTimeout(()=>{this.alert=void 0,e.status=0!=e.status,this.form.model=Object.assign({},e),this.form.fields[0].fieldGroup[0].template=`<h5>Vous modifiez de l'utilisateur <i>${e.login}</i> </h5>`,this.form.fields[0].fieldGroup[1].fieldGroup[0].templateOptions.label="Enregistrer",this.changeDetectorRef.detectChanges()},1)}}),this.user&&this.hasPermissionToDelete&&this.actions.push({type:"default",icon:"warning",shape:"circle",popConfirm:!0,popTitle:"Etes-vous s\xfbre ?",cancelText:"Annuler",okText:"Oui",loading:!1,click:e=>{this.swingstatus(e)},cancel:e=>{}}),this.user&&this.hasPermissionToDelete&&this.actions.push({type:"default",icon:"delete",shape:"circle",popConfirm:!0,popTitle:"Etes-vous s\xfbre ?",cancelText:"Annuler",okText:"Oui",loading:!1,click:e=>{this.delete(e,"menus",!1,e=>{this.changeDetectorRef.detectChanges()})},cancel:e=>{}})}save(e){var t;if(console.log(e),1==this.isEditMode){this.changeDetectorRef.detectChanges(),this.logger.log("event.model: ",e.model);let t=Object.assign(Object.assign({},e.model),{phone:e.model.prefix+" "+e.model.phone,session:this.user.session_id});this.logger.log("payload ",t);const i=t.id;t=f._.omit(t,["id"]),t=Object.assign(Object.assign({},t),{updated_user:this.user.id}),this.putData(`${f.T5}/menus/${i}`,t,e=>{e instanceof g.UA||(this.loadData(this.currentLoadEvent),this.isVisible=!1)})}else{this.logger.log("model: ",e.model);let i=Object.assign(Object.assign({},e.model),{routing:e.model.parent_code?e.model.namespace+"/"+e.model.routing:e.model.namespace,permission:null===(t=e.model.permission)||void 0===t?void 0:t.join(",").toUpperCase(),order:parseInt(e.model.order),session:this.user.session_id});if(i=f._.omit(i,["right"]),i.id&&null!=i.id){const e=i.id;i=f._.omit(i,["id"]),i=Object.assign(Object.assign({},i),{updated_user:this.user.id}),this.putData(`${f.T5}/menus/${e}`,i,e=>{this.form.options.resetModel(),e instanceof g.UA||(this.form.fields=this.mapFields(this.form.fields,"parent_code","templateOptions.options",this.data),this.changeDetectorRef.detectChanges())})}else i=f._.omit(i,["id"]),i=Object.assign(Object.assign({},i),{added_user:this.user.id}),this.postData(`${f.T5}/menus`,i,e=>{this.form.options.resetModel(),e instanceof g.UA||(this.form.fields=this.mapFields(this.form.fields,"parent_code","templateOptions.options",this.data),this.changeDetectorRef.detectChanges())})}}swingstatus(e){const t=e.id,i=e.status;if(1==i){let i=f._.omit(e,["id"]);i={status:!1,updated_user:this.user.id},this.putData(`${f.T5}/menus/${t}`,i,e=>{e instanceof g.UA||this.loadData(this.currentLoadEvent)})}if(0==i){let i=f._.omit(e,["id"]);i={status:!0,updated_user:this.user.id},this.putData(`${f.T5}/menus/${t}`,i,e=>{e instanceof g.UA||this.loadData(this.currentLoadEvent)})}}loadData(e){this.loading=!0,this.currentLoadEvent=e,this.getData(`${this.hasPermissionToShowAllEntityData?`${f.T5}/menus/`:`${f.T5}/menus`}?page=${e.first/e.rows+1}&per_page=${e.rows}${null!=e.globalFilter?`&search={"sKey":"all","sValue":"${e.globalFilter}"}`:""}${e.sortField&&null!=e.sortField?`&sort=[{"sortField":"${e.sortField}","sortOrder":"${1==e.sortOrder?"ASC":"DESC"}"}]`:'&sort=[{"sortField":"id","sortOrder":"DESC"}]'}`,e=>{if(!(e instanceof g.UA)){let t=e.body.rows;this.user&&!this.user.is_root&&(t=t.filter(e=>!e.is_root)),this.hasPermissionToShowDataRoot||(t=t.filter(e=>!e.profiles.map(e=>e.code).includes("PROF_ROOT"))),t=t.map(e=>Object.assign(Object.assign({},e),{trClass:e.status?"Actif":"Inactif"})),this.data=t,this.loading=!1,this.changeDetectorRef.detectChanges()}})}loadAllmenu(){this.httpService.getData(`${f.T5}/menus`).toPromise().then(e=>{this.form.fields=this.mapFields(J,"parent_code","templateOptions.options",e.body.rows),this.changeDetectorRef.detectChanges()}).catch(e=>{this.logger.error(e)})}loadAllpermission(){this.httpService.getData(`${f.T5}/menus`).toPromise().then(e=>{this.form.fields=this.mapFields(J,"parent_code","templateOptions.options",e.body.rows),this.changeDetectorRef.detectChanges()}).catch(e=>{this.logger.error(e)})}handleCancel(){this.isVisible=!1}}return e.\u0275fac=function(t){return new(t||e)(b.Y36(v.Kf),b.Y36(S.O),b.Y36(T.L),b.Y36(O.dD),b.Y36(y.e),b.Y36(x.h),b.Y36(r.Sf),b.Y36(b.sBO))},e.\u0275cmp=b.Xpm({type:e,selectors:[["menu-component"]],features:[b.qOj],decls:11,vars:18,consts:[["nzWidth","920px",3,"nzVisible","nzTitle","nzFooter","nzVisibleChange","nzOnCancel"],[3,"alert","model","fields","options","onSubmit","onModelChange",4,"nzModalContent"],[2,"width","100%","text-align","center"],[2,"border","3px dashed whitesmoke","padding","400px"],[2,"font-size","small"],[1,"button-19",2,"margin-left","20px",3,"click"],[3,"data","styleClass","showTools","columns","actions","lazy","caption","paginator","rows","totalRecords","loading","globalFilterFields","onLazyLoad"],[3,"alert","model","fields","options","onSubmit","onModelChange"]],template:function(e,t){1&e&&(b.TgZ(0,"nz-modal",0),b.NdJ("nzVisibleChange",function(e){return t.isVisible=e})("nzOnCancel",function(){return t.handleCancel()}),b.YNc(1,H,1,4,"wl-form",1),b.qZA(),b._UZ(2,"br"),b.TgZ(3,"table",2),b.TgZ(4,"tr",3),b.TgZ(5,"td"),b.TgZ(6,"h5",4),b._uU(7," Ajouter un menu en cliquant sur ce bouton "),b.TgZ(8,"button",5),b.NdJ("click",function(){return t.maFonction()}),b._uU(9,"Ajouter"),b.qZA(),b.qZA(),b.qZA(),b.qZA(),b.qZA(),b.TgZ(10,"wl-table",6),b.NdJ("onLazyLoad",function(e){return t.loadData(e)}),b.qZA()),2&e&&(b.Q6J("nzVisible",t.isVisible)("nzTitle",t.modalTitle)("nzFooter",null),b.xp6(10),b.Udp("margin-top","1rem"),b.Q6J("data",t.data)("styleClass","p-datatable-gridlines p-datatable-sm")("showTools",t.hasPermissionToExport)("columns",t.columns)("showTools",!0)("actions",t.actions)("lazy",!0)("caption","Menus")("paginator",!0)("rows",t.rows)("totalRecords",t.totalRecords)("loading",t.loading)("globalFilterFields",t.globalFilterFields))},directives:[r.du,r.Hf,a.a,l.U],styles:[".search-input .inline{display:inline-block;margin:0!important;padding:0!important}  .search-input .inline nz-input-group{border-radius:.2rem 0 0 .2rem!important}  .search-input .inline:last-child button{border-radius:0 0 10px 0}  .search-input .inline:last-child{position:relative;top:1.8rem;left:-1.5px;margin:0;padding:0}  .search-input .inline:last-child nz-input-group{border-radius:0 .2rem .2rem 0!important}  .button-19{background:#0d6d3a;border:1px solid #0d6d3a;border-radius:6px;box-shadow:1px 2px 4px rgba(0,0,0,.1);box-sizing:border-box;color:#fff;cursor:pointer;display:inline-block;font-family:nunito,roboto,proxima-nova,proxima nova,sans-serif;font-size:13px;font-weight:800;line-height:16px;min-height:40px;outline:0;padding:12px 14px;text-align:center;text-rendering:geometricprecision;text-transform:none;-moz-user-select:none;user-select:none;-webkit-user-select:none;touch-action:manipulation;vertical-align:middle}  .button-19:active,   .button-19:hover{background-color:transparent;background-color:initial;background-position:0 0;color:#0d6d3a}"],changeDetection:0}),e})(),Q=(()=>{class e{constructor(e,t){this.router=e,this.authService=t}canActivate(e,t){return!!this.authService.hasMenuAuthorization("MENU")||(this.router.navigate(["/private"]),!1)}}return e.\u0275fac=function(t){return new(t||e)(b.LFG(c.F0),b.LFG(y.e))},e.\u0275prov=b.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),W=(()=>{class e{constructor(e,t){this.router=e,this.authService=t}canActivate(e,t){return!!this.authService.hasMenuAuthorization("PROFIL")||(this.router.navigate(["/private"]),!1)}}return e.\u0275fac=function(t){return new(t||e)(b.LFG(c.F0),b.LFG(y.e))},e.\u0275prov=b.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),X=(()=>{class e{constructor(e,t){this.router=e,this.authService=t}canActivate(e,t){return!!this.authService.hasMenuAuthorization("PROFIL_MENU")||(this.router.navigate(["/private"]),!1)}}return e.\u0275fac=function(t){return new(t||e)(b.LFG(c.F0),b.LFG(y.e))},e.\u0275prov=b.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),ee=(()=>{class e{constructor(e,t){this.router=e,this.authService=t}canActivate(e,t){return!!this.authService.hasMenuAuthorization("PROFIL_PERM")||(this.router.navigate(["/private"]),!1)}}return e.\u0275fac=function(t){return new(t||e)(b.LFG(c.F0),b.LFG(y.e))},e.\u0275prov=b.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),te=(()=>{class e{constructor(e,t){this.router=e,this.authService=t}canActivate(e,t){return!!this.authService.hasMenuAuthorization("PERMISSION")||(this.router.navigate(["/private"]),!1)}}return e.\u0275fac=function(t){return new(t||e)(b.LFG(c.F0),b.LFG(y.e))},e.\u0275prov=b.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ie=[{path:"",component:(()=>{class e extends p.K{constructor(e,t,i,s,o,l){super(e,t,i,s,o,l),this.logger=e,this.httpService=t,this.envService=i,this.messageService=s,this.authService=o,this.menuService=l}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(b.Y36(v.Kf),b.Y36(S.O),b.Y36(T.L),b.Y36(O.dD),b.Y36(y.e),b.Y36(x.h))},e.\u0275cmp=b.Xpm({type:e,selectors:[["access-management"]],features:[b.qOj],decls:2,vars:0,template:function(e,t){1&e&&(b.TgZ(0,"p"),b._uU(1," access-management works "),b.qZA())},styles:[""]}),e})()},{path:"profile",component:A,canActivate:[W],data:{title:"Profile",breadcrumb:"Profile"}},{path:"permission",component:R,canActivate:[te],data:{title:"Permission",breadcrumb:"Permission"}},{path:"profile-menu",canActivate:[X],component:U,data:{title:"Droit d'acc\xe8s",breadcrumb:"Droit d'acc\xe8s"}},{path:"profile-permission",canActivate:[ee],component:q,data:{title:"Permission profil",breadcrumb:"Permission profil"}},{path:"menu",canActivate:[Q],component:B,data:{title:"Menu",breadcrumb:"Menu"}}];let se=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=b.oAB({type:e}),e.\u0275inj=b.cJS({imports:[[c.Bz.forChild(ie)],c.Bz]}),e})(),oe=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=b.oAB({type:e}),e.\u0275inj=b.cJS({imports:[[s.ez,o.u5,o.UX,se,l.e,a.n,r.Qp,n.j,d.Q]]}),e})()}}]);