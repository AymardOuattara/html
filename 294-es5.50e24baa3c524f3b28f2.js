!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,a){if(!e)return;if("string"==typeof e)return t(e,a);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,a)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"))?o:String(o)),n)}var i,o}function i(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var a,n=c(e);if(t){var i=c(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return l(this,a)}}function l(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(self.webpackChunkwil_admin_angular=self.webpackChunkwil_admin_angular||[]).push([[294],{88808:function(e,t,n){"use strict";n.d(t,{G:function(){return x}});var r=n(99688),l=n(42394),c={},d={formState:{token:localStorage.getItem("token")}},u=[{wrappers:["fieldset-wrapper"],templateOptions:{label:"Formulaire de cr\xe9ation",toggleable:!0},fieldGroup:[{fieldGroupClassName:"d-flex flex-wrap",fieldGroup:[{className:"flex-3 wl-hidden",key:"id",type:"input",templateOptions:{translate:!0,label:"FORM_LABEL.ID",readonly:!0}},{className:"flex-3",key:"code",type:"input",templateOptions:{translate:!0,label:"FORM_LABEL.CODE",required:!0}},{className:"flex-3",key:"name",type:"input",templateOptions:{translate:!0,label:"FORM_LABEL.NAME",required:!0}},{className:"flex-3",key:"entity_type_id",type:"select",templateOptions:{translate:!0,showSearch:!0,label:"FORM_LABEL.ENTITY_TYPE",valueProp:"id",options:[],required:!0}},{className:"flex-3",key:"email",type:"input-email",templateOptions:{translate:!0,label:"FORM_LABEL.EMAIL",pattern:/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/},validation:{messages:{pattern:function(e,t){return'"'.concat(t.formControl.value,"\" n'est pas une adresse email valide")}}}},{className:"flex-3",fieldGroupClassName:"d-flex search-input",fieldGroup:[{className:"inline flex-3",key:"prefix",type:"select",templateOptions:{translate:!0,showSearch:!0,label:"Telephone",labelProp:"phone_prefix",valueProp:"phone_prefix",options:[]},expressionProperties:{"templateOptions.required":"model.phone"}},{className:"inline flex-7",key:"phone",type:"input",templateOptions:{suffixIcon:"phone",type:"number",minLength:6},validation:{messages:{pattern:function(e,t){return"Le num\xe9ro ".concat(t.formControl.value," n'est pas valide")}}}}]},{className:"flex-3",key:"address",type:"input",templateOptions:{translate:!0,label:"FORM_LABEL.ADDRESS"}},{className:"flex-3",key:"logo",type:"file-upload",templateOptions:{translate:!0,listType:"picture",uploadUrl:l.T5+"/upload",authToken:d.formState.token,fileBasePath:l.M5+"/",uploadSuccessText:"Chargement r\xe9ussi",uploadFailText:"Chargement \xe9chou\xe9",label:"FORM_LABEL.LOGO",fileList:c.logo?[{url:c.logo,thumbUrl:c.logo}]:[]},expressionProperties:{"templateOptions.hide":function(e,t,a){a.form.valueChanges.subscribe(function(e){e.logo||(a.templateOptions.fileList=[])})}},hooks:{onChanges:function(e){e.templateOptions.fileList=e.model.logo?[{url:e.model.logo,thumbUrl:e.model.logo}]:[]}}},{className:"flex-3",key:"status",type:"checkbox",templateOptions:{translate:!0,label:"FORM_LABEL.IS_ACTIVE"},defaultValue:!0}]},{fieldGroupClassName:"action-bloc",fieldGroup:[{className:"flex-1",type:"button",templateOptions:{type:"submit",label:"FORM_LABEL.SUBMIT",translate:!0,loading:!1,disabled:!0,colorType:"primary",click:function(e){console.log("clik on submit"),e.templateOptions.loading=!0,e.form.statusChanges.subscribe(function(t){e.templateOptions.loading&&(e.templateOptions.loading=!1)})}},expressionProperties:{"templateOptions.disabled":function(e,t,a){return!a.form.valid}}},{type:"button",templateOptions:{type:"reset",label:"R\xe9initialiser",bgColor:"#000",textColor:"#fff",click:function(e){e.options.resetModel(c)}}}]}]}],p=n(91841),f=n(37716),m=n(44212),h=n(18859),g=n(52121),y=n(68058),E=n(4768),T=n(28723),b=n(38583),O=n(66782),v=n(65461),_=n(977);function A(e,t){if(1&e){var a=f.EpF();f.ynx(0),f.TgZ(1,"nz-spin",1),f.TgZ(2,"wl-form",2),f.NdJ("onSubmit",function(e){return f.CHM(a),f.oxw().save(e)})("onModelChange",function(e){return f.CHM(a),f.oxw().modelChange(e)}),f.qZA(),f.qZA(),f.BQk()}if(2&e){var n=f.oxw();f.xp6(1),f.Q6J("nzSpinning",n.isSpinning),f.xp6(1),f.Q6J("alert",n.alert)("model",n.form.model)("fields",n.form.fields)("options",n.form.options)}}function L(e,t){if(1&e){var a=f.EpF();f.ynx(0),f.TgZ(1,"wl-table",3),f.NdJ("onLazyLoad",function(e){return f.CHM(a),f.oxw().loadData(e)}),f.qZA(),f.BQk()}if(2&e){var n=f.oxw();f.xp6(1),f.Udp("margin-top","1rem"),f.Q6J("data",n.data)("styleClass","p-datatable-gridlines p-datatable-sm")("showTools",n.hasPermissionToExport)("wrapper","panel")("legend","Liste des donn\xe9es")("columns",n.columns)("actions",n.actions)("lazy",!0)("caption","Entit\xe9s")("paginator",!0)("rows",n.rows)("totalRecords",n.totalRecords)("loading",n.loading)("globalFilterFields",n.globalFilterFields)}}var x=function(){var e=function(e){o(n,e);var t=s(n);function n(e,i,o,r,s,l){var c;a(this,n),(c=t.call(this,e,i,o,r,s,l)).logger=e,c.httpService=i,c.envService=o,c.messageService=r,c.authService=s,c.menuService=l;var d=c.authService.hasPermissionAuthorizationV2(["ENTITY_CREATE.CREATE","ENTITY_CREATE.EDIT","ENTITY_CREATE.CONSULT","ENTITY_CREATE.EXPORT","ENTITY_CREATE.DELETE","SHOW_DATA.ALL_ENTITY","SHOW_DATA.ROOT"]);return c.hasPermissionToCreate=d[0],c.hasPermissionToEdit=d[1],c.hasPermissionToConsult=d[2],c.hasPermissionToExport=d[3],c.hasPermissionToDelete=d[4],c.hasPermissionToShowAllEntityData=d[5],c.hasPermissionToShowDataRoot=d[6],c}return i(n,[{key:"ngOnInit",value:function(){var e=this;this.form.options=d,this.form.fields=u,this.form.model=c,this.columns=[{field:"code",header:"FORM_LABEL.CODE"},{field:"name",header:"FORM_LABEL.NAME"},{field:"entity_type.label",header:"FORM_LABEL.ENTITY_TYPE"},{field:"email",header:"FORM_LABEL.EMAIL"},{field:"phone",header:"FORM_LABEL.PHONE"},{field:"address",header:"FORM_LABEL.ADDRESS"},{field:"logo",header:"FORM_LABEL.LOGO",type:"image"},{field:"status",header:"STATUS",type:"status",falseText:"Inactif",trueText:"Actif"}],this.user&&this.hasPermissionToEdit&&this.actions.push({type:"default",icon:"edit",shape:"circle",loading:!1,click:function(t){var a,n;e.edit(t),e.form.model=Object.assign(Object.assign({},t),{prefix:null===(a=t.phone)||void 0===a?void 0:a.split(" ")[0],phone:null===(n=t.phone)||void 0===n?void 0:n.split(" ")[1]}),e.form.fields[0].fieldGroup[1].fieldGroup[0].templateOptions.label="SAVE"}}),this.user&&this.hasPermissionToDelete&&this.actions.push({type:"default",icon:"delete",shape:"circle",popConfirm:!0,popTitle:"Etes-vous s\xfbre ?",cancelText:"Annuler",okText:"Oui",loading:!1,click:function(t){e.delete(t,"entities")},cancel:function(e){}}),this.loadAllType(),this.loadCountries()}},{key:"save",value:function(e){var t,a,n=this;this.logger.log("model: ",e.model);var i=Object.assign(Object.assign({},e.model),{phone:e.model.prefix+" "+e.model.phone,logo:null!=e.model.logo?(null===(t=e.model.logo[0])||void 0===t?void 0:t.url)||e.model.logo:"",added_user:this.user.id});if(i.id&&null!=i.id){var o=i.id;i=l._.omit(i,["id"]),null==e.model.logo?i=l._.omit(i,["logo"]):(null===(a=e.model.logo[0])||void 0===a?void 0:a.url)||(i=l._.omit(i,["logo"])),this.putData("".concat(l.T5,"/entities/").concat(o),i,function(e){n.form.options.resetModel(),e instanceof p.UA||n.loadData(n.currentLoadEvent)})}else i=l._.omit(i,["id"]),this.postData("".concat(l.T5,"/entities"),i,function(e){n.form.options.resetModel(),e instanceof p.UA||n.loadData(n.currentLoadEvent)})}},{key:"loadData",value:function(e){var t=this;this.currentLoadEvent=e;var a=this.hasPermissionToShowAllEntityData?"".concat(l.T5,"/entities/eager"):"".concat(l.T5,"/entities/byUserEntityAdded/").concat(this.user.entity.id);setTimeout(function(){var n=null!=e.globalFilter?'&search={"sKey":"all","sValue":"'.concat(e.globalFilter,'"}'):"";t.loading=!0,t.getData("".concat(a,"/?page=").concat(e.first/e.rows+1,"&per_page=").concat(e.rows).concat(n))},1)}},{key:"loadAllType",value:function(){var e=this;this.httpService.getData("".concat(l.T5,"/entity-types")).toPromise().then(function(t){var a=t.body.rows;e.isSpinning=!1,e.form.fields=e.mapFields(e.form.fields,"entity_type_id","templateOptions.options",a)}).catch(function(t){e.logger.error(t)})}},{key:"loadCountries",value:function(){var e=this;this.httpService.getData("".concat(l.T5,"/countries")).toPromise().then(function(t){var a=t.body.rows;e.isSpinning=!1,e.form.fields=e.mapFields(e.form.fields,"prefix","templateOptions.options",a)}).catch(function(t){e.logger.error(t)})}},{key:"modelChange",value:function(e){l._.values(e).every(l._.isEmpty)&&1!=e.status&&(this.form.model={status:!0},this.notAllPrivilege&&(this.form.model=Object.assign(Object.assign({},c),{entity_type_id:2})),this.form.fields=this.mapFields(this.form.fields,"status","defaultValue",!0))}}]),n}(r.K);return e.\u0275fac=function(t){return new(t||e)(f.Y36(m.Kf),f.Y36(h.O),f.Y36(g.L),f.Y36(y.dD),f.Y36(E.e),f.Y36(T.h))},e.\u0275cmp=f.Xpm({type:e,selectors:[["create"]],features:[f.qOj],decls:2,vars:2,consts:[[4,"ngIf"],["nzTip","Chargement...",3,"nzSpinning"],[3,"alert","model","fields","options","onSubmit","onModelChange"],[3,"data","styleClass","showTools","wrapper","legend","columns","actions","lazy","caption","paginator","rows","totalRecords","loading","globalFilterFields","onLazyLoad"]],template:function(e,t){1&e&&(f.YNc(0,A,3,5,"ng-container",0),f.YNc(1,L,2,16,"ng-container",0)),2&e&&(f.Q6J("ngIf",t.hasPermissionToCreate),f.xp6(1),f.Q6J("ngIf",t.hasPermissionToConsult))},directives:[b.O5,O.W,v.U,_.a],styles:[".search-input .inline{display:inline-block;margin:0!important;padding:0!important}  .search-input .inline nz-input-group{border-radius:.2rem 0 0 .2rem!important}  .search-input .inline:last-child button{border-radius:0 0 10px 0}  .search-input .inline:last-child{position:relative;top:1.8rem;left:-1.5px;margin:0;padding:0}  .search-input .inline:last-child nz-input-group{border-radius:0 .2rem .2rem 0!important}"]}),e}()},17524:function(e,t,n){"use strict";n.d(t,{MB:function(){return l},bz:function(){return c},fn:function(){return d},t0:function(){return u},_w:function(){return p}});var o=n(37716),r=n(95987),s=n(4768),l=function(){var e=function(){function e(t,n){a(this,e),this.router=t,this.authService=n}return i(e,[{key:"canActivate",value:function(e,t){return!!this.authService.hasMenuAuthorization("ENTITY_CREATE")||(this.router.navigate(["/private"]),!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(o.LFG(r.F0),o.LFG(s.e))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),c=function(){var e=function(){function e(t,n){a(this,e),this.router=t,this.authService=n}return i(e,[{key:"canActivate",value:function(e,t){return!!this.authService.hasMenuAuthorization("AGENCE")||(this.router.navigate(["/private"]),!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(o.LFG(r.F0),o.LFG(s.e))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),d=function(){var e=function(){function e(t,n){a(this,e),this.router=t,this.authService=n}return i(e,[{key:"canActivate",value:function(e,t){return!!this.authService.hasMenuAuthorization("ENTITY_PARAMETER")||(this.router.navigate(["/private"]),!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(o.LFG(r.F0),o.LFG(s.e))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),u=function(){var e=function(){function e(t,n){a(this,e),this.router=t,this.authService=n}return i(e,[{key:"canActivate",value:function(e,t){return!!this.authService.hasMenuAuthorization("ENTITY_USER")||(this.router.navigate(["/private"]),!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(o.LFG(r.F0),o.LFG(s.e))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),p=function(){var e=function(){function e(t,n){a(this,e),this.router=t,this.authService=n}return i(e,[{key:"canActivate",value:function(e,t){return!!this.authService.hasMenuAuthorization("RELATED_ENTITY")||(this.router.navigate(["/private"]),!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(o.LFG(r.F0),o.LFG(s.e))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},45294:function(t,n,r){"use strict";r.r(n),r.d(n,{OrganizationalModule:function(){return Z}});var l=r(38583),c=r(3679),d=r(95987),u=r(88808),p=r(17524),f=r(37716),m=function(){var e=function(){function e(){a(this,e)}return i(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=f.Xpm({type:e,selectors:[["organizational"]],decls:2,vars:0,template:function(e,t){1&e&&(f.TgZ(0,"p"),f._uU(1," organizational works "),f.qZA())},styles:[""]}),e}(),h=r(99688),g=r(44212),y=r(18859),E=r(52121),T=r(68058),b=r(4768),O=r(28723),v=function(){var e=function(e){o(n,e);var t=s(n);function n(e,i,o,r,s,l){var c;return a(this,n),(c=t.call(this,e,i,o,r,s,l)).logger=e,c.httpService=i,c.envService=o,c.messageService=r,c.authService=s,c.menuService=l,c}return i(n,[{key:"ngOnInit",value:function(){}}]),n}(h.K);return e.\u0275fac=function(t){return new(t||e)(f.Y36(g.Kf),f.Y36(y.O),f.Y36(E.L),f.Y36(T.dD),f.Y36(b.e),f.Y36(O.h))},e.\u0275cmp=f.Xpm({type:e,selectors:[["site"]],features:[f.qOj],decls:2,vars:0,template:function(e,t){1&e&&(f.TgZ(0,"p"),f._uU(1," site works "),f.qZA())},styles:[""]}),e}(),_=r(42394),A={},L={formState:{token:localStorage.getItem("token"),data:[],user_id:null,entity_id:null}},x=[{template:"<strong>Note:</strong> Tout d'abord, recherchez le login de l'utilisateur dans la base de donn\xe9es, puis ajoutez-le \xe0 votre entit\xe9"},{fieldGroupClassName:"d-flex flex-wrap",fieldGroup:[{key:"action",type:"input",hide:!0},{className:"flex-auto wl-hidden",key:"user_id",type:"input",templateOptions:{translate:!0,label:"FORM_LABEL.ID",readonly:!0}},{className:"flex-4",fieldGroupClassName:"d-flex search-input",fieldGroup:[{className:"inline",key:"login",type:"input",templateOptions:{translate:!0,label:"FORM_LABEL.LOGIN",required:!0,change:function(e,t){console.log(e.model.login)}},validation:{show:!0}},{className:"inline",type:"button",templateOptions:{type:"submit",icon:"search",loading:!1,disabled:!0,click:function(e){e.model.action="searchSSO",e.templateOptions.loading=!0,e.form.statusChanges.subscribe(function(t){e.templateOptions.loading&&(e.templateOptions.loading=!1)})}},expressionProperties:{"templateOptions.disabled":"!model.login"}}]},{className:"flex-10",fieldGroupClassName:"d-flex flex-wrap",wrappers:["fieldset-wrapper"],templateOptions:{label:"Informations de l'utilisateur",toggleable:!0,collapsed:!1},fieldGroup:[{className:"flex-4",key:"first_name",type:"input",templateOptions:{translate:!0,translatePlaceholder:!0,readonly:!0,required:!0,label:"FORM_LABEL.FIRST_NAME",placeholder:"FORM_LABEL.FIRST_NAME",suffixIcon:"user"}},{className:"flex-4",key:"last_name",type:"input",templateOptions:{translate:!0,translatePlaceholder:!0,readonly:!0,required:!0,label:"FORM_LABEL.LAST_NAME",placeholder:"FORM_LABEL.LAST_NAME",suffixIcon:"user"}},{className:"flex-4",key:"email",type:"input-email",templateOptions:{translate:!0,translatePlaceholder:!0,readonly:!0,required:!0,label:"FORM_LABEL.EMAIL",placeholder:"FORM_LABEL.EMAIL",suffixIcon:"mail"}},{className:"flex-4",key:"phone",type:"input",templateOptions:{translate:!0,translatePlaceholder:!0,readonly:!0,label:"FORM_LABEL.PHONE",placeholder:"FORM_LABEL.PHONE",suffixIcon:"phone"}}]},{className:"flex-10",fieldGroupClassName:"d-flex flex-wrap",wrappers:["fieldset-wrapper"],templateOptions:{label:"Informations de la relation avec l'entit\xe9",toggleable:!0,collapsed:!1},fieldGroup:[{className:"flex-3",key:"entity_id",type:"select",templateOptions:{translate:!0,showSearch:!0,translatePlaceholder:!0,required:!0,label:"FORM_LABEL.ENTITY",placeholder:"FORM_LABEL.ENTITY",suffixIcon:"bank",options:[],valueProp:"id",labelProp:"name",url:_.T5+"/entities/load",authToken:localStorage.getItem("token")}},{className:"flex-3",key:"is_main",type:"checkbox",templateOptions:{translate:!0,label:"Est entit\xe9 principale ?"},defaultValue:!1},{className:"flex-3",key:"status",type:"checkbox",templateOptions:{translate:!0,label:"FORM_LABEL.IS_ACTIVE"},defaultValue:!0},{className:"flex-10",key:"rattachements",type:"grid",wrappers:["panel-wrapper"],templateOptions:{toggleable:!0,label:"Liste des entit\xe9s d\xe9j\xe0 rattach\xe9es \xe0 l'utilisateur",columns:[{field:"code",header:"FORM_LABEL.CODE"},{field:"name",header:"FORM_LABEL.NAME"},{field:"EntityUser.is_main",header:"Est principale",type:"status",falseText:"Non",trueText:"Oui"},{field:"status",header:"STATUS",type:"status",falseText:"Inactif",trueText:"Actif"}],data:L.formState.data,actions:[{type:"default",icon:"delete",title:"R\xe9tirer l'utilisateur de l'entit\xe9",shape:"circle",popConfirm:!0,popTitle:"Etes-vous s\xfbre ?",cancelText:"Annuler",okText:"Oui",loading:!1,click:function(e){fetch("".concat(_.T5,"/entity-users/").concat(e.EntityUser.user_id,"/").concat(e.EntityUser.entity_id),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(function(t){200==t.status&&t.json().then(function(t){console.log(t),L.formState.data=L.formState.data.filter(function(t){return t.id!=e.id})})})},cancel:function(e){}}]},expressionProperties:{"templateOptions.data":function(e,t,a){return L.formState.data}}}]}]},{fieldGroupClassName:"action-bloc",fieldGroup:[{className:"flex-1",type:"button",templateOptions:{type:"submit",label:"FORM_LABEL.SUBMIT",translate:!0,loading:!1,disabled:!0,colorType:"primary",click:function(e){e.model.action="save",e.templateOptions.loading=!0,e.form.statusChanges.subscribe(function(t){e.templateOptions.loading&&(e.templateOptions.loading=!1)})}},expressionProperties:{"templateOptions.disabled":function(e,t,a){return!a.form.valid}}},{type:"button",templateOptions:{type:"reset",label:"R\xe9initialiser",bgColor:"#000",textColor:"#fff",click:function(e){e.options.resetModel(A)}}}]}],S=r(91841),R=r(66782),N=r(84828),w=r(65461),k=r(977);function M(e,t){if(1&e){var a=f.EpF();f.ynx(0),f.TgZ(1,"nz-tab",2),f.TgZ(2,"wl-form",3),f.NdJ("onSubmit",function(e){return f.CHM(a),f.oxw().save(e)})("onModelChange",function(e){return f.CHM(a),f.oxw().modelChange(e)}),f.qZA(),f.qZA(),f.BQk()}if(2&e){var n=f.oxw();f.xp6(2),f.Q6J("alert",n.alert)("model",n.form.model)("fields",n.form.fields)("options",n.form.options)}}function C(e,t){if(1&e&&(f.ynx(0),f.TgZ(1,"nz-tab",4),f._UZ(2,"wl-table",5),f.TgZ(3,"nz-tab",6),f._UZ(4,"wl-table",7),f.qZA(),f.qZA(),f.BQk()),2&e){var a=f.oxw();f.xp6(2),f.Udp("margin-top","1rem"),f.Q6J("data",a.data)("styleClass","p-datatable-gridlines p-datatable-sm")("showTools",a.hasPermissionToExport)("columns",a.columns)("actions",a.actions)("caption"," ")("paginator",!0)("rows",a.rows)("totalRecords",a.data.length)("loading",a.loading)("globalFilterFields",a.globalFilterFields),f.xp6(2),f.Udp("margin-top","1rem"),f.Q6J("data",a.dataRattachement)("showTools",!1)("columns",a.columnsRattachement)("actions",a.actions)("caption"," ")("paginator",!0)("rows",a.rows)("totalRecords",a.data.length)("loading",a.loading)("globalFilterFields",a.globalFilterFields)}}var F=function(){var e=function(e){o(n,e);var t=s(n);function n(e,i,o,r,s,l){var c;a(this,n),(c=t.call(this,e,i,o,r,s,l)).logger=e,c.httpService=i,c.envService=o,c.messageService=r,c.authService=s,c.menuService=l;var d=c.authService.hasPermissionAuthorizationV2(["ENTITY_USER.CREATE","ENTITY_USER.EDIT","ENTITY_USER.CONSULT","ENTITY_USER.EXPORT","ENTITY_USER.DELETE","SHOW_DATA.ALL_ENTITY","SHOW_DATA.ROOT"]);return c.hasPermissionToCreate=d[0],c.hasPermissionToEdit=d[1],c.hasPermissionToConsult=d[2],c.hasPermissionToExport=d[3],c.hasPermissionToDelete=d[4],c.hasPermissionToShowAllEntityData=d[5],c.hasPermissionToShowDataRoot=d[6],c}return i(n,[{key:"ngOnInit",value:function(){var e=this;this.form.options=L,this.form.model=this.user&&!this.user.is_root?Object.assign(Object.assign({},A),{entity_id:this.user.entity.id}):A,this.form.fields=this.user&&!this.user.is_root?this.mapFields(x,"entity_id","hide",!0):x,this.hasPermissionToConsult&&(this.loadUsers(),this.loadDataRattachement()),this.columns=[{field:"login",header:"Login"},{field:"first_name",header:"Nom"},{field:"last_name",header:"Pr\xe9noms"},{field:"email",header:"Email"},{field:"phone",header:"Contact"},{field:"status",header:"STATUS",type:"status",falseText:"Inactif",trueText:"Actif"}],this.columnsRattachement=[{field:"code",header:"Code"},{field:"name",header:"Nom"},{field:"EntityUser.is_main",header:"Est principale?",type:"status",falseText:"Non",trueText:"Oui"},{field:"status",header:"STATUS",type:"status",falseText:"Inactif",trueText:"Actif"}],this.user&&this.hasPermissionToDelete&&this.actions.push({type:"default",icon:"delete",title:"R\xe9tirer l'utilisateur de l'entit\xe9",shape:"circle",popConfirm:!0,popTitle:"Etes-vous s\xfbre ?",cancelText:"Annuler",okText:"Oui",loading:!1,click:function(t){e.deleteData("".concat(_.T5,"/entity-users/").concat(t.EntityUser.user_id,"/").concat(t.EntityUser.entity_id),function(t){t instanceof S.Zn&&e.loadUsers()})},cancel:function(e){}})}},{key:"save",value:function(e){var t=this;if(this.logger.log("this.form.model: ",this.form.model),"searchSSO"==e.model.action)this.searchUser(e.model.login);else{var a=Object.assign(Object.assign({},e.model),{meta_data:JSON.stringify(e.model.meta_data)});if(this.logger.log("payload ",a),a.id&&null!=a.id){var n=a.id;a=_._.omit(a,["id"]),a=Object.assign(Object.assign({},a),{updated_user:this.user.id}),this.putData("".concat(_.T5,"/entity-users/").concat(n),a)}else a=Object.assign(Object.assign({},a),{added_user:this.user.id}),this.postData("".concat(_.T5,"/entity-users"),a,function(e){t.loadDataRattachement(),t.form.options.formState.data=[]})}}},{key:"searchUser",value:function(e){var t=this;this.alert=void 0,this.httpService.postData("".concat(_.T5,"/users/searchByLogin"),{login:e}).toPromise().then(function(a){console.log(a),a.body.data?(t.form.options.formState.data=a.body.data.entities,t.form.model={login:a.body.data.login||"",first_name:a.body.data.first_name||"",last_name:a.body.data.last_name||"",email:a.body.data.email||"",phone:a.body.data.phone||"",user_id:a.body.data.id||""}):(t.form.options.resetModel(),t.form.model={login:e,entity_id:t.hasPermissionToShowAllEntityData?null:t.user.entity.id},t.alert={type:"error",message:a.body.message},t.setBackendError({message:a.body.message}))}).catch(function(a){t.form.options.resetModel(),t.form.model={login:e},t.logger.error(a),t.alert={type:"error",message:a.statusText,description:a.error.message.error},t.setBackendError({message:a.statusText})}).finally(function(){t.form.fields[1].fieldGroup[2].fieldGroup[1].templateOptions.loading=!1})}},{key:"loadUsers",value:function(){var e=this;this.httpService.getData("".concat(_.T5,"/entity-users/byEntity/").concat(this.user.entity.id)).toPromise().then(function(t){var a;e.logger.log(t),e.isSpinning=!1,e.data=null===(a=t.body.rows[0])||void 0===a?void 0:a.users}).catch(function(t){e.logger.error(t)})}},{key:"loadDataRattachement",value:function(){var e=this;this.httpService.postData("".concat(_.T5,"/users/searchByLogin"),{login:this.user.login}).toPromise().then(function(t){console.log(t),e.dataRattachement=t.body.data.entities}).catch(function(t){e.setBackendError({message:t.statusText})}).finally(function(){})}}]),n}(h.K);return e.\u0275fac=function(t){return new(t||e)(f.Y36(g.Kf),f.Y36(y.O),f.Y36(E.L),f.Y36(T.dD),f.Y36(b.e),f.Y36(O.h))},e.\u0275cmp=f.Xpm({type:e,selectors:[["entity-user"]],features:[f.qOj],decls:4,vars:3,consts:[["nzTip","Chargement...",3,"nzSpinning"],[4,"ngIf"],["nzTitle","Rattacher un utilisateur"],[3,"alert","model","fields","options","onSubmit","onModelChange"],["nzTitle","Liste des utilisateurs rattach\xe9s \xe0 votre entit\xe9"],[3,"data","styleClass","showTools","columns","actions","caption","paginator","rows","totalRecords","loading","globalFilterFields"],["nzTitle","Liste des entit\xe9s auquelles vous \xeates rattach\xe9s"],[3,"data","showTools","columns","actions","caption","paginator","rows","totalRecords","loading","globalFilterFields"]],template:function(e,t){1&e&&(f.TgZ(0,"nz-spin",0),f.TgZ(1,"nz-tabset"),f.YNc(2,M,3,4,"ng-container",1),f.YNc(3,C,5,25,"ng-container",1),f.qZA(),f.qZA()),2&e&&(f.Q6J("nzSpinning",t.isSpinning),f.xp6(2),f.Q6J("ngIf",t.hasPermissionToCreate),f.xp6(1),f.Q6J("ngIf",t.hasPermissionToConsult))},directives:[R.W,N.xH,l.O5,N.xw,w.U,k.a],styles:[".search-input .inline{display:inline-block;margin:0}  .search-input .inline nz-input-group{border-radius:.2rem 0 0 .2rem!important}  .search-input .inline:last-child button{border-radius:0 0 10px 0}  .search-input .inline:last-child{position:relative;top:1.8rem;left:-1.5px}"]}),e}(),P={},I={formState:{token:localStorage.getItem("token"),data:[]}},B=[{fieldGroupClassName:"d-flex flex-wrap",fieldGroup:[{template:"<strong>Note:</strong> Tout d'abord, recherchez le code ou le nom de l'entit\xe9 dans la base de donn\xe9es, puis rattachez-la \xe0 votre entit\xe9"},{fieldGroupClassName:"d-flex flex-wrap",fieldGroup:[{key:"action",type:"input",hide:!0},{className:"flex-auto wl-hidden",key:"id",type:"input",templateOptions:{translate:!0,hidden:!0,label:"FORM_LABEL.ID",readonly:!0}},{className:"flex-4",fieldGroupClassName:"d-flex flex-wrap search-input",fieldGroup:[{className:"inline",key:"code",type:"input",templateOptions:{translate:!0,label:"FORM_LABEL.CODE",required:!0},validation:{show:!0}},{className:"inline",type:"button",templateOptions:{type:"submit",icon:"search",loading:!1,disabled:!0,click:function(e){e.model.action="search",e.templateOptions.loading=!0,e.form.statusChanges.subscribe(function(t){e.templateOptions.loading&&(e.templateOptions.loading=!1)})}},expressionProperties:{"templateOptions.disabled":"!model.code"}}]},{className:"flex-10",fieldGroupClassName:"d-flex flex-wrap",wrappers:["fieldset-wrapper"],templateOptions:{label:"Informations de l'entit\xe9",toggleable:!0,collapsed:!1},fieldGroup:[{className:"flex-4",key:"name",type:"input",templateOptions:{translate:!0,translatePlaceholder:!0,readonly:!0,required:!0,label:"FORM_LABEL.NAME",placeholder:"FORM_LABEL.NAME"}},{className:"flex-4",key:"email",type:"input-email",templateOptions:{translate:!0,translatePlaceholder:!0,readonly:!0,required:!0,label:"FORM_LABEL.EMAIL",placeholder:"FORM_LABEL.EMAIL",suffixIcon:"mail"}},{className:"flex-4",key:"address",type:"input",templateOptions:{translate:!0,translatePlaceholder:!0,readonly:!0,label:"FORM_LABEL.ADDRESS",placeholder:"FORM_LABEL.ADDRESS",suffixIcon:"user"}},{className:"flex-4",key:"phone",type:"input",templateOptions:{translate:!0,translatePlaceholder:!0,readonly:!0,required:!0,label:"FORM_LABEL.PHONE",placeholder:"FORM_LABEL.PHONE",suffixIcon:"phone"}}]},{className:"flex-10",fieldGroupClassName:"d-flex flex-wrap",wrappers:["fieldset-wrapper"],templateOptions:{label:"Informations de la relation avec l'entit\xe9",toggleable:!0,collapsed:!1},fieldGroup:[{className:"flex-3",key:"entity_source",type:"select",templateOptions:{translate:!0,showSearch:!0,translatePlaceholder:!0,required:!0,label:"FORM_LABEL.ENTITY",placeholder:"FORM_LABEL.ENTITY",suffixIcon:"bank",options:[],valueProp:"id",labelProp:"name",url:_.T5+"/entities/load",authToken:localStorage.getItem("token")}},{className:"flex-3 wl-hidden",key:"meta_data.relation_type",type:"input",templateOptions:{translate:!0,translatePlaceholder:!0,label:"FORM_LABEL.ACCES_KEY",placeholder:"FORM_LABEL.ACCES_KEY"}},{className:"flex-3",key:"relation_type_id",type:"select",templateOptions:{translate:!0,translatePlaceholder:!0,required:!0,valueProp:"id",labelProp:"label",label:"FORM_LABEL.TYPE_RELATION",placeholder:"FORM_LABEL.TYPE_RELATION",url:_.T5+"/relation-type/load",authToken:localStorage.getItem("token"),options:[],onModelChange:function(e,t){var a=e.templateOptions.options.find(function(e){return e.id==t});e.form.get("meta_data.relation_type").setValue(null==a?void 0:a.label)}}},{className:"flex-3",key:"status",type:"checkbox",templateOptions:{translate:!0,label:"FORM_LABEL.IS_ACTIVE"},defaultValue:!0},{className:"flex-10",key:"rattachements",type:"grid",wrappers:["panel-wrapper"],templateOptions:{toggleable:!0,label:"Liste des entit\xe9s d\xe9j\xe0 rattach\xe9es \xe0 l'entit\xe9",columns:[{field:"code",header:"FORM_LABEL.CODE"},{field:"name",header:"FORM_LABEL.NAME"},{field:"meta_data.relation_type",header:"FORM_LABEL.TYPE_RELATION"},{field:"status",header:"STATUS",type:"status",falseText:"Inactif",trueText:"Actif"}],data:I.formState.data,actions:[{type:"default",icon:"delete",title:"R\xe9tirer l'entit\xe9",shape:"circle",popConfirm:!0,popTitle:"Etes-vous s\xfbre ?",cancelText:"Annuler",okText:"Oui",loading:!1,click:function(e){fetch("".concat(_.T5,"/related-entities/").concat(e.RelatedEntity.entity_source,"/").concat(e.RelatedEntity.entity_destination),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(function(t){200==t.status&&t.json().then(function(t){console.log(t),I.formState.data=I.formState.data.filter(function(t){return t.id!=e.id})})})},cancel:function(e){}}]},expressionProperties:{"templateOptions.data":function(e,t,a){return I.formState.data}}}]}]},{fieldGroupClassName:"action-bloc",fieldGroup:[{className:"flex-1",type:"button",templateOptions:{type:"submit",label:"FORM_LABEL.SUBMIT",translate:!0,loading:!1,disabled:!0,colorType:"primary",click:function(e){e.model.action="save",e.templateOptions.loading=!0,e.form.statusChanges.subscribe(function(t){e.templateOptions.loading&&(e.templateOptions.loading=!1)})}},expressionProperties:{"templateOptions.disabled":function(e,t,a){return!a.form.valid}}},{type:"button",templateOptions:{type:"reset",label:"R\xe9initialiser",bgColor:"#000",textColor:"#fff",click:function(e){e.options.resetModel(P)}}}]}]}];function D(e,t){if(1&e){var a=f.EpF();f.ynx(0),f.TgZ(1,"nz-tab",2),f.TgZ(2,"wl-form",3),f.NdJ("onSubmit",function(e){return f.CHM(a),f.oxw().save(e)})("onModelChange",function(e){return f.CHM(a),f.oxw().modelChange(e)}),f.qZA(),f.qZA(),f.BQk()}if(2&e){var n=f.oxw();f.xp6(2),f.Q6J("alert",n.alert)("model",n.form.model)("fields",n.form.fields)("options",n.form.options)}}function Y(e,t){if(1&e&&(f.ynx(0),f.TgZ(1,"nz-tab",4),f._UZ(2,"wl-table",5),f.qZA(),f.BQk()),2&e){var a=f.oxw();f.xp6(2),f.Udp("margin-top","1rem"),f.Q6J("data",a.data)("styleClass","p-datatable-gridlines p-datatable-sm")("showTools",a.hasPermissionToExport)("columns",a.columns)("actions",a.actions)("caption"," ")("paginator",!0)("rows",a.rows)("totalRecords",a.data.length)("loading",a.loading)("globalFilterFields",a.globalFilterFields)}}var z,U,j=[{path:"",component:m},{path:"site",component:v,data:{title:"MENU_LABEL.Sites",breadcrumb:"MENU_LABEL.Sites"}},{path:"agences",canActivate:[p.bz],component:u.G,data:{title:"Agences",breadcrumb:"Agences"}},{path:"entity",loadChildren:function(){return r.e(725).then(r.bind(r,74725)).then(function(e){return e.EntityModule})},data:{title:"MENU_LABEL.Entity",breadcrumb:"MENU_LABEL.Entity"}},{path:"entity-user",canActivate:[p.t0],component:F,data:{title:"MENU_LABEL.Entity_User",breadcrumb:"MENU_LABEL.Entity_User"}},{path:"related-entity",canActivate:[p._w],component:(z=function(t){o(r,t);var n=s(r);function r(e,t,i,o,s,l){var c;a(this,r),(c=n.call(this,e,t,i,o,s,l)).logger=e,c.httpService=t,c.envService=i,c.messageService=o,c.authService=s,c.menuService=l;var d=c.authService.hasPermissionAuthorizationV2(["RELATED_ENTITY.CREATE","RELATED_ENTITY.EDIT","RELATED_ENTITY.CONSULT","RELATED_ENTITY.EXPORT","RELATED_ENTITY.DELETE","SHOW_DATA.ALL_ENTITY","SHOW_DATA.ROOT"]);return c.hasPermissionToCreate=d[0],c.hasPermissionToEdit=d[1],c.hasPermissionToConsult=d[2],c.hasPermissionToExport=d[3],c.hasPermissionToDelete=d[4],c.hasPermissionToShowAllEntityData=d[5],c.hasPermissionToShowDataRoot=d[6],c}return i(r,[{key:"ngOnInit",value:function(){var e=this;this.form.model=this.user&&!this.user.is_root?Object.assign(Object.assign({},P),{entity_id:this.user.entity.id}):P,this.form.fields=this.user&&!this.user.is_root?this.mapFields(B,"entity_id","hide",!0):B,this.form.options=I,this.isSpinning=!1,this.hasPermissionToConsult&&this.loadEntities(),this.columns=[{field:"code",header:"FORM_LABEL.CODE"},{field:"name",header:"FORM_LABEL.NAME"},{field:"entity_type.label",header:"FORM_LABEL.ENTITY_TYPE"},{field:"meta_data.relation_type",header:"FORM_LABEL.TYPE_RELATION"},{field:"email",header:"FORM_LABEL.EMAIL"},{field:"phone",header:"FORM_LABEL.PHONE"},{field:"address",header:"FORM_LABEL.ADDRESS"},{field:"logo",header:"FORM_LABEL.LOGO",type:"image"},{field:"status",header:"STATUS",type:"status",falseText:"Inactif",trueText:"Actif"}],this.user&&this.hasPermissionToDelete&&this.actions.push({type:"default",icon:"delete",title:"R\xe9tirer l'entit\xe9",shape:"circle",popConfirm:!0,popTitle:"Etes-vous s\xfbre ?",cancelText:"Annuler",okText:"Oui",loading:!1,click:function(t){e.deleteData("".concat(_.T5,"/related-entities/").concat(t.RelatedEntity.entity_source,"/").concat(t.RelatedEntity.entity_destination),function(t){t instanceof S.Zn&&e.loadEntities()})},cancel:function(e){}})}},{key:"save",value:function(e){var t=this;if(this.logger.log("this.form.model: ",this.form.model),"search"==e.model.action)this.searchEntity(e.model.code);else{var a=Object.assign(Object.assign({},e.model),{added_user:this.user.id,meta_data:JSON.stringify(e.model.meta_data)});this.logger.log("payload ",a),a=Object.assign(Object.assign({},a),{added_user:this.user.id}),this.postData("".concat(_.T5,"/related-entities"),a,function(e){e instanceof S.Zn&&(t.loadEntities(),t.form.options.formState.data=[])})}}},{key:"searchEntity",value:function(t){var a=this;this.alert=void 0,this.httpService.postData("".concat(_.T5,"/entities/searchByCode"),{code:t}).toPromise().then(function(n){if(console.log(n),n.body.data){a.form.model=Object.assign(Object.assign({},a.form.model),{code:n.body.data.code||"",name:n.body.data.name||"",address:n.body.data.address||"",email:n.body.data.email||"",phone:n.body.data.phone||"",entity_destination:n.body.data.id||""});var i=n.body.data.source.map(function(e){return Object.assign(Object.assign({},e),{meta_data:JSON.parse(e.RelatedEntity.meta_data)})}),o=n.body.data.destination.map(function(e){return Object.assign(Object.assign({},e),{meta_data:JSON.parse(e.RelatedEntity.meta_data)})});a.form.options.formState.data=[].concat(e(i),e(o))}else a.form.options.resetModel(),a.form.model={code:t},a.alert={type:"error",message:n.body.message},a.setBackendError({message:n.body.message})}).catch(function(e){a.form.options.resetModel(),a.form.model={code:t},a.logger.error(e),a.alert={type:"error",message:e.statusText,description:e.error.message.error},a.setBackendError({message:e.statusText})}).finally(function(){a.form.fields[0].fieldGroup[1].fieldGroup[2].fieldGroup[1].templateOptions.loading=!1})}},{key:"loadEntities",value:function(){var e=this;this.httpService.getData("".concat(_.T5,"/related-entities/byEntity/").concat(this.user.entity.id)).toPromise().then(function(t){var a;e.logger.log(t),e.isSpinning=!1,e.data=null===(a=t.body.rows[0])||void 0===a?void 0:a.source,e.data=e.data.map(function(e){return Object.assign(Object.assign({},e),{meta_data:JSON.parse(e.RelatedEntity.meta_data)})})}).catch(function(t){e.logger.error(t)})}}]),r}(h.K),z.\u0275fac=function(e){return new(e||z)(f.Y36(g.Kf),f.Y36(y.O),f.Y36(E.L),f.Y36(T.dD),f.Y36(b.e),f.Y36(O.h))},z.\u0275cmp=f.Xpm({type:z,selectors:[["related-entity"]],features:[f.qOj],decls:4,vars:3,consts:[["nzTip","Chargement...",3,"nzSpinning"],[4,"ngIf"],["nzTitle","Rattacher une entit\xe9"],[3,"alert","model","fields","options","onSubmit","onModelChange"],["nzTitle","Liste des entit\xe9s rattach\xe9es \xe0 votre entit\xe9"],[3,"data","styleClass","showTools","columns","actions","caption","paginator","rows","totalRecords","loading","globalFilterFields"]],template:function(e,t){1&e&&(f.TgZ(0,"nz-spin",0),f.TgZ(1,"nz-tabset"),f.YNc(2,D,3,4,"ng-container",1),f.YNc(3,Y,3,13,"ng-container",1),f.qZA(),f.qZA()),2&e&&(f.Q6J("nzSpinning",t.isSpinning),f.xp6(2),f.Q6J("ngIf",t.hasPermissionToCreate),f.xp6(1),f.Q6J("ngIf",t.hasPermissionToConsult))},directives:[R.W,N.xH,l.O5,N.xw,w.U,k.a],styles:[".search-input .inline{display:inline-block;margin:0}  .search-input .inline nz-input-group{border-radius:.2rem 0 0 .2rem!important}  .search-input .inline:last-child{position:relative;top:1.8rem;left:-1.5px}  .search-input .inline:last-child button{border-radius:0 0 10px 0}  .generate-input{display:flex;align-items:flex-end}  .generate-input .inline{display:inline-block;margin:0}"]}),z),data:{title:"MENU_LABEL.Related_Entity",breadcrumb:"MENU_LABEL.Related_Entity"}}],G=function(){var e=i(function e(){a(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=f.oAB({type:e}),e.\u0275inj=f.cJS({imports:[[d.Bz.forChild(j)],d.Bz]}),e}(),Z=((U=i(function e(){a(this,e)})).\u0275fac=function(e){return new(e||U)},U.\u0275mod=f.oAB({type:U}),U.\u0275inj=f.cJS({imports:[[l.ez,c.u5,c.UX,G,w.e,k.n,R.j,N.we]]}),U)}}])}();